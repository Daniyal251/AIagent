<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–ó–∞–∫–∞–∑–∞—Ç—å —Å–∞–π—Ç ‚Äî –í–µ–±-—Å—Ç—É–¥–∏—è</title>
<meta name="description" content="–ó–∞–∫–∞–∂–∏—Ç–µ —Å–∞–π—Ç –¥–ª—è –≤–∞—à–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞ –æ—Ç 5000‚ÇΩ. AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø–æ–º–æ–∂–µ—Ç –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ –∑–∞ 5 –º–∏–Ω—É—Ç.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root {
  --bg: #0a0b0f;
  --bg2: #12131a;
  --bg3: #1a1b26;
  --bg4: #22243a;
  --surface: #1e2035;
  --border: rgba(255,255,255,0.06);
  --text: #e8e6f0;
  --text2: #9d9bb0;
  --text3: #6b6980;
  --accent: #7c6ff7;
  --accent2: #9b8aff;
  --accent-glow: rgba(124,111,247,0.15);
  --green: #4ade80;
  --green-bg: rgba(74,222,128,0.08);
  --orange: #fb923c;
  --orange-bg: rgba(251,146,60,0.08);
  --pink: #f472b6;
  --blue: #60a5fa;
  --red: #f87171;
  --yellow: #fbbf24;
  --radius: 16px;
  --radius-sm: 10px;
  --shadow: 0 8px 32px rgba(0,0,0,0.4);
}

* { margin:0; padding:0; box-sizing:border-box; }
html { scroll-behavior: smooth; }

body {
  font-family: 'Manrope', -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100dvh;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}

/* ‚ïê‚ïê‚ïê NOISE TEXTURE ‚ïê‚ïê‚ïê */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");
  pointer-events: none;
  z-index: 0;
}

/* ‚ïê‚ïê‚ïê GLOW ORBS ‚ïê‚ïê‚ïê */
.orb {
  position: fixed;
  border-radius: 50%;
  filter: blur(100px);
  pointer-events: none;
  z-index: 0;
}
.orb-1 { width: 500px; height: 500px; background: rgba(124,111,247,0.08); top: -150px; right: -150px; }
.orb-2 { width: 400px; height: 400px; background: rgba(244,114,182,0.06); bottom: 10%; left: -100px; }
.orb-3 { width: 300px; height: 300px; background: rgba(96,165,250,0.05); top: 50%; right: 10%; }

/* ‚ïê‚ïê‚ïê CONTAINER ‚ïê‚ïê‚ïê */
.container {
  max-width: 1100px;
  margin: 0 auto;
  padding: 0 20px;
  position: relative;
  z-index: 1;
}

/* ‚ïê‚ïê‚ïê HEADER ‚ïê‚ïê‚ïê */
.header {
  padding: 20px 0;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.logo {
  display: flex;
  align-items: center;
  gap: 10px;
  text-decoration: none;
}
.logo-icon {
  width: 40px;
  height: 40px;
  border-radius: 12px;
  background: linear-gradient(135deg, var(--accent), var(--pink));
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  font-weight: 800;
  color: #fff;
  letter-spacing: -1px;
}
.logo-text {
  font-size: 18px;
  font-weight: 700;
  color: var(--text);
  letter-spacing: -0.3px;
}
.header-badge {
  padding: 6px 14px;
  border-radius: 20px;
  background: var(--green-bg);
  color: var(--green);
  font-size: 12px;
  font-weight: 600;
  border: 1px solid rgba(74,222,128,0.15);
}

/* ‚ïê‚ïê‚ïê HERO ‚ïê‚ïê‚ïê */
.hero {
  padding: 60px 0 40px;
  text-align: center;
}
.hero-eyebrow {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 8px 18px;
  border-radius: 30px;
  background: var(--accent-glow);
  border: 1px solid rgba(124,111,247,0.2);
  color: var(--accent2);
  font-size: 13px;
  font-weight: 600;
  margin-bottom: 24px;
}
.hero h1 {
  font-size: clamp(32px, 6vw, 56px);
  font-weight: 800;
  line-height: 1.1;
  letter-spacing: -1.5px;
  margin-bottom: 16px;
  background: linear-gradient(135deg, var(--text) 0%, var(--accent2) 50%, var(--pink) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}
.hero p {
  font-size: clamp(16px, 2.5vw, 20px);
  color: var(--text2);
  max-width: 600px;
  margin: 0 auto 32px;
  line-height: 1.5;
}
.hero-cta {
  display: inline-flex;
  align-items: center;
  gap: 10px;
  padding: 16px 36px;
  border-radius: 14px;
  background: linear-gradient(135deg, var(--accent), #6c5ce7);
  color: #fff;
  font-size: 17px;
  font-weight: 700;
  border: none;
  cursor: pointer;
  transition: all 0.3s;
  text-decoration: none;
  box-shadow: 0 4px 24px rgba(124,111,247,0.3);
}
.hero-cta:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 32px rgba(124,111,247,0.5);
}
.hero-cta:active { transform: translateY(0); }

/* ‚ïê‚ïê‚ïê TRUST ‚ïê‚ïê‚ïê */
.trust {
  display: flex;
  justify-content: center;
  gap: 32px;
  padding: 24px 0;
  flex-wrap: wrap;
}
.trust-item {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
  color: var(--text3);
}
.trust-item span { font-size: 18px; }

/* ‚ïê‚ïê‚ïê PRICING CARDS ‚ïê‚ïê‚ïê */
.pricing-section {
  padding: 60px 0 40px;
}
.section-title {
  text-align: center;
  font-size: clamp(24px, 4vw, 36px);
  font-weight: 800;
  letter-spacing: -0.5px;
  margin-bottom: 8px;
}
.section-sub {
  text-align: center;
  color: var(--text2);
  font-size: 15px;
  margin-bottom: 40px;
}
.pricing-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
  gap: 16px;
}
.price-card {
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 24px;
  transition: all 0.3s;
  cursor: pointer;
  position: relative;
  overflow: hidden;
}
.price-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--accent), var(--pink));
  opacity: 0;
  transition: opacity 0.3s;
}
.price-card:hover {
  border-color: rgba(124,111,247,0.3);
  transform: translateY(-4px);
  box-shadow: 0 12px 40px rgba(0,0,0,0.3);
}
.price-card:hover::before { opacity: 1; }
.price-card.selected {
  border-color: var(--accent);
  background: rgba(124,111,247,0.05);
}
.price-card.selected::before { opacity: 1; }
.pc-emoji { font-size: 32px; margin-bottom: 12px; display: block; }
.pc-name { font-size: 17px; font-weight: 700; margin-bottom: 6px; }
.pc-desc { font-size: 13px; color: var(--text2); margin-bottom: 16px; line-height: 1.4; }
.pc-price {
  font-size: 24px;
  font-weight: 800;
  color: var(--accent2);
  letter-spacing: -0.5px;
}
.pc-price small { font-size: 14px; font-weight: 500; color: var(--text3); }
.pc-badge {
  position: absolute;
  top: 12px;
  right: 12px;
  padding: 3px 10px;
  border-radius: 8px;
  font-size: 11px;
  font-weight: 700;
  background: var(--orange-bg);
  color: var(--orange);
  border: 1px solid rgba(251,146,60,0.2);
}
.pc-info {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  margin-top: 12px;
  padding: 6px 12px;
  border-radius: 8px;
  background: rgba(124,111,247,0.06);
  border: 1px solid rgba(124,111,247,0.15);
  color: var(--accent2);
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  width: 100%;
  justify-content: center;
}
.pc-info:hover {
  background: rgba(124,111,247,0.12);
  border-color: rgba(124,111,247,0.3);
}

/* ‚ïê‚ïê‚ïê PREVIEW MODAL ‚ïê‚ïê‚ïê */
.preview-overlay {
  position: fixed;
  inset: 0;
  z-index: 150;
  background: rgba(0,0,0,0.7);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s;
}
.preview-overlay.active {
  opacity: 1;
  pointer-events: auto;
}
.preview-modal {
  width: 100%;
  max-width: 680px;
  max-height: 90vh;
  overflow-y: auto;
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: 20px;
  box-shadow: 0 24px 80px rgba(0,0,0,0.5);
  transform: translateY(20px) scale(0.97);
  transition: transform 0.3s;
  position: relative;
}
.preview-overlay.active .preview-modal {
  transform: translateY(0) scale(1);
}
.pm-close {
  position: absolute;
  top: 16px;
  right: 16px;
  width: 36px;
  height: 36px;
  border-radius: 10px;
  background: var(--bg3);
  border: 1px solid var(--border);
  color: var(--text2);
  font-size: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 2;
  transition: all 0.2s;
}
.pm-close:hover { background: var(--bg4); color: var(--text); }

.pm-hero {
  padding: 32px 28px 20px;
  border-bottom: 1px solid var(--border);
}
.pm-hero-top {
  display: flex;
  align-items: flex-start;
  gap: 16px;
  margin-bottom: 16px;
}
.pm-emoji {
  font-size: 48px;
  line-height: 1;
  flex-shrink: 0;
}
.pm-title { font-size: 24px; font-weight: 800; letter-spacing: -0.5px; margin-bottom: 4px; }
.pm-subtitle { font-size: 14px; color: var(--text2); line-height: 1.5; }
.pm-price-row {
  display: flex;
  align-items: baseline;
  gap: 8px;
  margin-top: 4px;
}
.pm-price { font-size: 28px; font-weight: 800; color: var(--accent2); }
.pm-price-note { font-size: 13px; color: var(--text3); }

.pm-body { padding: 24px 28px; }

.pm-section {
  margin-bottom: 24px;
}
.pm-section:last-child { margin-bottom: 0; }
.pm-section-title {
  font-size: 13px;
  font-weight: 700;
  color: var(--text2);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 12px;
}
.pm-features {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
}
.pm-feature {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  font-size: 13px;
  line-height: 1.4;
  padding: 8px 10px;
  border-radius: 8px;
  background: var(--bg3);
}
.pm-feature-icon { flex-shrink: 0; font-size: 15px; }
.pm-audience {
  padding: 14px 16px;
  border-radius: 12px;
  background: var(--accent-glow);
  border: 1px solid rgba(124,111,247,0.15);
  font-size: 14px;
  line-height: 1.5;
  color: var(--text);
}
.pm-audience b { color: var(--accent2); }

/* Mock site preview */
.pm-mockup {
  border-radius: 12px;
  overflow: hidden;
  border: 1px solid var(--border);
  background: #fff;
  position: relative;
}
.pm-mockup-bar {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 12px;
  background: #f0f0f2;
  border-bottom: 1px solid #e0e0e4;
}
.pm-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
}
.pm-dot-r { background: #ff5f57; }
.pm-dot-y { background: #ffbd2e; }
.pm-dot-g { background: #28ca41; }
.pm-mockup-url {
  flex: 1;
  margin-left: 8px;
  padding: 3px 10px;
  border-radius: 4px;
  background: #fff;
  font-size: 11px;
  color: #666;
  font-family: 'JetBrains Mono', monospace;
}
.pm-mockup-body {
  min-height: 220px;
  position: relative;
}
.pm-mockup-label {
  position: absolute;
  bottom: 8px;
  right: 8px;
  padding: 3px 8px;
  border-radius: 4px;
  background: rgba(0,0,0,0.6);
  color: #fff;
  font-size: 10px;
  font-weight: 600;
}

.pm-cta {
  display: flex;
  gap: 10px;
  margin-top: 24px;
}
.pm-cta-btn {
  flex: 1;
  padding: 14px;
  border-radius: 12px;
  border: none;
  font-size: 15px;
  font-weight: 700;
  font-family: inherit;
  cursor: pointer;
  transition: all 0.2s;
  text-align: center;
}
.pm-cta-primary {
  background: linear-gradient(135deg, var(--accent), #6c5ce7);
  color: #fff;
  box-shadow: 0 4px 20px rgba(124,111,247,0.3);
}
.pm-cta-primary:hover { box-shadow: 0 8px 32px rgba(124,111,247,0.5); }
.pm-cta-secondary {
  background: var(--bg3);
  color: var(--text);
  border: 1px solid var(--border);
}
.pm-cta-secondary:hover { background: var(--bg4); }

/* ‚ïê‚ïê‚ïê TABLET ‚ïê‚ïê‚ïê */
@media (max-width: 1024px) and (min-width: 641px) {
  .pricing-grid { grid-template-columns: repeat(3, 1fr); gap: 12px; }
  .preview-modal { max-width: 580px; }
  .pm-hero-top { gap: 14px; }
  .portfolio-grid { grid-template-columns: repeat(2, 1fr); }
}

/* ‚ïê‚ïê‚ïê MOBILE ‚ïê‚ïê‚ïê */
@media (max-width: 640px) {
  /* Preview ‚Üí full-screen bottom sheet */
  .preview-overlay {
    align-items: flex-end;
    padding: 0;
  }
  .preview-modal {
    max-height: 92vh;
    border-radius: 20px 20px 0 0;
    width: 100%;
    max-width: 100%;
  }
  .preview-overlay.active .preview-modal {
    transform: translateY(0) scale(1);
  }
  .pm-hero { padding: 20px 16px 14px; }
  .pm-hero-top { flex-direction: column; gap: 10px; }
  .pm-emoji { font-size: 36px; }
  .pm-title { font-size: 20px; }
  .pm-subtitle { font-size: 13px; }
  .pm-price { font-size: 22px; }
  .pm-body { padding: 16px; }
  .pm-features { grid-template-columns: 1fr; gap: 6px; }
  .pm-feature { padding: 8px; font-size: 13px; }
  .pm-section-title { font-size: 12px; }
  .pm-audience { font-size: 13px; padding: 12px; }
  .pm-cta { flex-direction: column; gap: 8px; margin-top: 16px; }
  .pm-cta-btn { padding: 14px; font-size: 15px; }
  .pm-mockup-body { padding: 14px !important; min-height: 180px !important; }
  .pm-close { top: 12px; right: 12px; width: 32px; height: 32px; }

  /* Drag indicator on mobile */
  .preview-modal::before {
    content: '';
    display: block;
    width: 36px;
    height: 4px;
    border-radius: 2px;
    background: var(--text3);
    margin: 10px auto 0;
    opacity: 0.5;
  }
}

/* ‚ïê‚ïê‚ïê ORDER FORM ‚ïê‚ïê‚ïê */
.order-section {
  padding: 40px 0 60px;
}
.order-form {
  max-width: 560px;
  margin: 0 auto;
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 32px;
  box-shadow: var(--shadow);
}
.of-title {
  font-size: 22px;
  font-weight: 800;
  margin-bottom: 4px;
  letter-spacing: -0.3px;
}
.of-sub {
  font-size: 14px;
  color: var(--text2);
  margin-bottom: 24px;
}
.of-group {
  margin-bottom: 16px;
}
.of-label {
  display: block;
  font-size: 13px;
  font-weight: 600;
  color: var(--text2);
  margin-bottom: 6px;
}
.of-input {
  width: 100%;
  padding: 12px 16px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  background: var(--bg3);
  color: var(--text);
  font-size: 15px;
  font-family: inherit;
  outline: none;
  transition: border-color 0.2s;
}
.of-input:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-glow);
}
.of-input::placeholder { color: var(--text3); }
select.of-input {
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%239d9bb0' fill='none' stroke-width='1.5' stroke-linecap='round'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 14px center;
  padding-right: 38px;
}
.of-selected-type {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 16px;
  border-radius: var(--radius-sm);
  background: var(--accent-glow);
  border: 1px solid rgba(124,111,247,0.2);
  margin-bottom: 16px;
  font-size: 14px;
}
.of-selected-type .emoji { font-size: 24px; }
.of-selected-type .info { flex: 1; }
.of-selected-type .name { font-weight: 700; font-size: 15px; }
.of-selected-type .price { color: var(--accent2); font-weight: 600; }
.of-selected-type .change {
  padding: 4px 12px;
  border-radius: 8px;
  background: var(--bg3);
  border: 1px solid var(--border);
  color: var(--text2);
  font-size: 12px;
  cursor: pointer;
  font-family: inherit;
}

.of-submit {
  width: 100%;
  padding: 14px;
  border-radius: var(--radius-sm);
  background: linear-gradient(135deg, var(--accent), #6c5ce7);
  color: #fff;
  font-size: 16px;
  font-weight: 700;
  font-family: inherit;
  border: none;
  cursor: pointer;
  transition: all 0.3s;
  margin-top: 8px;
  box-shadow: 0 4px 20px rgba(124,111,247,0.3);
}
.of-submit:hover { box-shadow: 0 8px 32px rgba(124,111,247,0.5); transform: translateY(-1px); }
.of-submit:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

/* ‚ïê‚ïê‚ïê AI CHAT SCREEN ‚ïê‚ïê‚ïê */
.chat-screen {
  display: none;
  position: fixed;
  inset: 0;
  z-index: 100;
  background: var(--bg);
  flex-direction: column;
}
.chat-screen.active { display: flex; }

.chat-header {
  padding: 16px 20px;
  background: var(--bg2);
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  gap: 12px;
  flex-shrink: 0;
}
.chat-back {
  width: 36px;
  height: 36px;
  border-radius: 10px;
  background: var(--bg3);
  border: 1px solid var(--border);
  color: var(--text);
  font-size: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background 0.2s;
}
.chat-back:hover { background: var(--bg4); }
.chat-info { flex: 1; }
.chat-name { font-size: 15px; font-weight: 700; }
.chat-status { font-size: 12px; color: var(--green); font-weight: 500; }

.chat-progress {
  padding: 10px 20px;
  background: var(--bg2);
  border-bottom: 1px solid var(--border);
  flex-shrink: 0;
}
.cp-row { display: flex; justify-content: space-between; font-size: 12px; color: var(--text2); margin-bottom: 6px; }
.cp-bar { height: 4px; border-radius: 2px; background: var(--bg4); overflow: hidden; }
.cp-fill { height: 100%; border-radius: 2px; background: linear-gradient(90deg, var(--accent), var(--green)); transition: width 0.5s ease; }

.chat-messages {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  scroll-behavior: smooth;
}

.msg {
  max-width: 85%;
  padding: 12px 16px;
  border-radius: 16px;
  font-size: 14px;
  line-height: 1.55;
  word-break: break-word;
  animation: msgIn 0.3s ease;
}
@keyframes msgIn {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}
.msg.assistant {
  align-self: flex-start;
  background: var(--bg3);
  border: 1px solid var(--border);
  border-bottom-left-radius: 4px;
  color: var(--text);
}
.msg.user {
  align-self: flex-end;
  background: linear-gradient(135deg, var(--accent), #6c5ce7);
  color: #fff;
  border-bottom-right-radius: 4px;
}
.msg.system {
  align-self: center;
  background: var(--orange-bg);
  border: 1px solid rgba(251,146,60,0.15);
  color: var(--orange);
  font-size: 13px;
  text-align: center;
  max-width: 90%;
}
.msg img {
  max-width: 100%;
  max-height: 240px;
  border-radius: 10px;
  margin-top: 6px;
  cursor: pointer;
}
.msg b { font-weight: 700; }

.typing-dots {
  display: flex;
  gap: 5px;
  padding: 4px 0;
}
.typing-dots span {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--text3);
  animation: blink 1.4s infinite both;
}
.typing-dots span:nth-child(2) { animation-delay: 0.2s; }
.typing-dots span:nth-child(3) { animation-delay: 0.4s; }
@keyframes blink {
  0%, 80%, 100% { opacity: 0.3; transform: scale(0.8); }
  40% { opacity: 1; transform: scale(1); }
}

.chat-input-area {
  padding: 12px 16px;
  background: var(--bg2);
  border-top: 1px solid var(--border);
  display: flex;
  gap: 10px;
  align-items: flex-end;
  flex-shrink: 0;
}
.chat-attach {
  width: 42px;
  height: 42px;
  border-radius: 12px;
  background: var(--bg3);
  border: 1px solid var(--border);
  color: var(--text2);
  font-size: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  flex-shrink: 0;
  transition: all 0.2s;
}
.chat-attach:hover { background: var(--bg4); color: var(--text); }
.chat-textarea {
  flex: 1;
  padding: 10px 14px;
  border-radius: 12px;
  border: 1px solid var(--border);
  background: var(--bg3);
  color: var(--text);
  font-size: 15px;
  font-family: inherit;
  resize: none;
  outline: none;
  min-height: 42px;
  max-height: 120px;
  line-height: 1.4;
  transition: border-color 0.2s;
}
.chat-textarea:focus {
  border-color: var(--accent);
}
.chat-textarea::placeholder { color: var(--text3); }
.chat-send {
  width: 42px;
  height: 42px;
  border-radius: 12px;
  background: linear-gradient(135deg, var(--accent), #6c5ce7);
  border: none;
  color: #fff;
  font-size: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  flex-shrink: 0;
  transition: all 0.2s;
  box-shadow: 0 2px 12px rgba(124,111,247,0.3);
}
.chat-send:hover { transform: scale(1.05); }
.chat-send:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

.media-preview {
  display: none;
  padding: 8px 16px 0;
  background: var(--bg2);
  gap: 8px;
  flex-wrap: wrap;
}
.media-preview.show { display: flex; }
.media-thumb {
  width: 60px;
  height: 60px;
  border-radius: 8px;
  object-fit: cover;
  border: 2px solid var(--border);
}
.media-remove {
  position: absolute;
  top: -4px;
  right: -4px;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: var(--red);
  color: #fff;
  font-size: 12px;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}
.media-item {
  position: relative;
}

/* ‚ïê‚ïê‚ïê PORTFOLIO ‚ïê‚ïê‚ïê */
.portfolio-section {
  padding: 40px 0;
}
.portfolio-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 16px;
}
.port-card {
  border-radius: var(--radius);
  overflow: hidden;
  background: var(--bg2);
  border: 1px solid var(--border);
  transition: all 0.3s;
}
.port-card:hover { transform: translateY(-3px); box-shadow: var(--shadow); }
.port-img {
  width: 100%;
  height: 180px;
  background: linear-gradient(135deg, var(--bg3), var(--bg4));
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 48px;
}
.port-info { padding: 16px; }
.port-name { font-size: 15px; font-weight: 700; margin-bottom: 4px; }
.port-desc { font-size: 13px; color: var(--text2); }

/* ‚ïê‚ïê‚ïê FAQ ‚ïê‚ïê‚ïê */
.faq-section { padding: 40px 0 60px; }
.faq-item {
  border-bottom: 1px solid var(--border);
  padding: 18px 0;
}
.faq-q {
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.faq-q::after { content: '+'; font-size: 20px; color: var(--text3); transition: transform 0.2s; }
.faq-item.open .faq-q::after { content: '‚àí'; color: var(--accent); }
.faq-a {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s, padding 0.3s;
  font-size: 14px;
  color: var(--text2);
  line-height: 1.6;
}
.faq-item.open .faq-a { max-height: 200px; padding-top: 12px; }

/* ‚ïê‚ïê‚ïê FOOTER ‚ïê‚ïê‚ïê */
.footer {
  padding: 30px 0;
  text-align: center;
  border-top: 1px solid var(--border);
  font-size: 13px;
  color: var(--text3);
}

/* ‚ïê‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê */
.toast-msg {
  position: fixed;
  bottom: 80px;
  left: 50%;
  transform: translateX(-50%) translateY(20px);
  padding: 10px 24px;
  border-radius: 12px;
  background: var(--bg3);
  border: 1px solid var(--border);
  color: var(--text);
  font-size: 14px;
  font-weight: 500;
  z-index: 999;
  opacity: 0;
  transition: all 0.3s;
  box-shadow: var(--shadow);
  pointer-events: none;
}
.toast-msg.show { opacity: 1; transform: translateX(-50%) translateY(0); }

/* ‚ïê‚ïê‚ïê LOADING ‚ïê‚ïê‚ïê */
.loading-screen {
  position: fixed;
  inset: 0;
  background: var(--bg);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 200;
  flex-direction: column;
  gap: 16px;
}
.loader {
  width: 40px;
  height: 40px;
  border: 3px solid var(--border);
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* ‚ïê‚ïê‚ïê SAFE AREA ‚ïê‚ïê‚ïê */
@supports (padding-bottom: env(safe-area-inset-bottom)) {
  .chat-input-area { padding-bottom: calc(12px + env(safe-area-inset-bottom)); }
}

/* ‚ïê‚ïê‚ïê MOBILE ‚ïê‚ïê‚ïê */
/* ‚ïê‚ïê‚ïê TABLET GENERAL ‚ïê‚ïê‚ïê */
@media (max-width: 1024px) and (min-width: 641px) {
  .hero h1 { font-size: 40px; }
  .hero p { font-size: 17px; }
  .order-form { max-width: 500px; }
  .trust { gap: 24px; }
  .of-group[style*="grid-template-columns"] { grid-template-columns: 1fr 1fr; }
}

/* ‚ïê‚ïê‚ïê MOBILE GENERAL ‚ïê‚ïê‚ïê */
@media (max-width: 640px) {
  .hero { padding: 36px 0 20px; }
  .hero-eyebrow { font-size: 12px; padding: 6px 14px; margin-bottom: 18px; }
  .hero h1 { font-size: 26px; letter-spacing: -0.5px; }
  .hero p { font-size: 14px; margin-bottom: 24px; }
  .hero-cta { padding: 14px 28px; font-size: 15px; width: 100%; justify-content: center; }
  .trust { gap: 10px; justify-content: space-between; }
  .trust-item { font-size: 11px; gap: 4px; }
  .trust-item span { font-size: 15px; }

  /* Pricing grid: 2 columns on phone */
  .pricing-section { padding: 40px 0 24px; }
  .section-title { font-size: 20px; }
  .section-sub { font-size: 13px; margin-bottom: 24px; }
  .pricing-grid { grid-template-columns: 1fr 1fr; gap: 8px; }
  .price-card { padding: 14px 12px; }
  .pc-emoji { font-size: 22px; margin-bottom: 6px; }
  .pc-name { font-size: 13px; margin-bottom: 4px; }
  .pc-desc { font-size: 11px; margin-bottom: 8px; line-height: 1.3; }
  .pc-price { font-size: 18px; }
  .pc-badge { top: 8px; right: 8px; font-size: 9px; padding: 2px 7px; }
  .pc-info { font-size: 11px; padding: 5px 8px; margin-top: 8px; }

  /* Order form */
  .order-section { padding: 24px 0 40px; }
  .order-form { padding: 20px 16px; border-radius: 14px; }
  .of-title { font-size: 19px; }
  .of-sub { font-size: 13px; }
  .of-input { padding: 10px 14px; font-size: 14px; }
  .of-submit { font-size: 15px; padding: 13px; }
  .of-selected-type { padding: 10px 12px; font-size: 13px; }
  .of-selected-type .emoji { font-size: 20px; }

  /* Portfolio */
  .portfolio-grid { grid-template-columns: 1fr; gap: 12px; }
  .port-img { height: 140px; }

  /* FAQ */
  .faq-q { font-size: 14px; }
  .faq-a { font-size: 13px; }

  /* Chat */
  .container { padding: 0 14px; }
  .chat-messages { padding: 12px; }
  .msg { max-width: 92%; font-size: 14px; padding: 10px 14px; }
  .chat-header { padding: 12px 16px; }
  .chat-input-area { padding: 10px 12px; }
  .chat-textarea { font-size: 15px; padding: 10px 12px; }
  .chat-attach, .chat-send { width: 40px; height: 40px; }

  /* Header */
  .logo-text { font-size: 16px; }
  .header-badge { font-size: 11px; padding: 5px 10px; }
}

/* ‚ïê‚ïê‚ïê VERY SMALL PHONES ‚ïê‚ïê‚ïê */
@media (max-width: 380px) {
  .pricing-grid { grid-template-columns: 1fr; }
  .price-card { display: flex; gap: 12px; align-items: center; padding: 14px; }
  .pc-emoji { font-size: 28px; margin-bottom: 0; flex-shrink: 0; }
  .pc-name { font-size: 14px; }
  .pc-desc { margin-bottom: 4px; }
  .pc-info { margin-top: 6px; }
  .hero h1 { font-size: 24px; }
  .of-group[style*="grid-template-columns"] { display: flex !important; flex-direction: column; gap: 12px !important; }
}
</style>
</head>
<body>

<!-- Background orbs -->
<div class="orb orb-1"></div>
<div class="orb orb-2"></div>
<div class="orb orb-3"></div>

<!-- Loading screen -->
<div class="loading-screen" id="loadingScreen">
  <div class="loader"></div>
  <div style="color:var(--text2);font-size:14px">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
</div>

<!-- ‚ïê‚ïê‚ïê LANDING PAGE ‚ïê‚ïê‚ïê -->
<div id="landingPage">

  <div class="container">
    <!-- Header -->
    <div class="header">
      <a href="#" class="logo">
        <div class="logo-icon">S</div>
        <div class="logo-text">–°–∞–π—Ç—ã</div>
      </a>
      <div class="header-badge">‚úì –î–µ–ª–∞–µ–º –∑–∞ 3 –¥–Ω—è</div>
    </div>

    <!-- Hero -->
    <div class="hero">
      <div class="hero-eyebrow">üöÄ –°–∞–π—Ç –¥–ª—è –≤–∞—à–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞</div>
      <h1>–°–∞–π—Ç, –∫–æ—Ç–æ—Ä—ã–π<br>–ø—Ä–∏–≤–æ–¥–∏—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤</h1>
      <p>AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Å–æ–±–µ—Ä—ë—Ç –≤—Å—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∑–∞ 5 –º–∏–Ω—É—Ç. –í—ã –ø–æ–ª—É—á–∏—Ç–µ –≥–æ—Ç–æ–≤—ã–π —Å–∞–π—Ç —á–µ—Ä–µ–∑ 3 –¥–Ω—è. –û—Ç 5 000‚ÇΩ.</p>
      <a href="#order" class="hero-cta" onclick="scrollToOrder(event)">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ ‚Üí</a>
    </div>

    <!-- Trust -->
    <div class="trust">
      <div class="trust-item"><span>‚ö°</span> –ì–æ—Ç–æ–≤–æ –∑–∞ 3 –¥–Ω—è</div>
      <div class="trust-item"><span>üí∞</span> –û—Ç 5 000‚ÇΩ</div>
      <div class="trust-item"><span>üîÑ</span> –ü—Ä–∞–≤–∫–∏ –±–µ—Å–ø–ª–∞—Ç–Ω–æ</div>
      <div class="trust-item"><span>üì±</span> –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω</div>
    </div>

    <!-- Pricing -->
    <div class="pricing-section" id="pricing">
      <div class="section-title">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Å–∞–π—Ç–∞</div>
      <div class="section-sub">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞</div>
      <div class="pricing-grid" id="pricingGrid"></div>
    </div>

    <!-- Order Form -->
    <div class="order-section" id="order">
      <div class="order-form" id="orderForm">
        <div class="of-title">üìã –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</div>
        <div class="of-sub">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É ‚Äî AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Å–æ–±–µ—Ä—ë—Ç –¥–µ—Ç–∞–ª–∏</div>
        
        <div id="selectedTypeBlock" style="display:none"></div>

        <div class="of-group">
          <label class="of-label">–ù–∞–∑–≤–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å–∞ *</label>
          <input class="of-input" id="ofName" placeholder="–ü—Ä–∏–º–µ—Ä: –ö–∞—Ñ–µ ¬´–£—é—Ç¬ª" autocomplete="organization">
        </div>
        <div class="of-group">
          <label class="of-label">–í–∞—à–µ –∏–º—è</label>
          <input class="of-input" id="ofContact" placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?" autocomplete="name">
        </div>
        <div class="of-group" style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
          <div>
            <label class="of-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
            <input class="of-input" id="ofPhone" placeholder="+7..." type="tel" autocomplete="tel">
          </div>
          <div>
            <label class="of-label">–ì–æ—Ä–æ–¥</label>
            <input class="of-input" id="ofCity" placeholder="–ú–æ—Å–∫–≤–∞" autocomplete="address-level2">
          </div>
        </div>
        <div class="of-group" id="typeSelectGroup">
          <label class="of-label">–¢–∏–ø —Å–∞–π—Ç–∞</label>
          <select class="of-input" id="ofType"></select>
        </div>
        <div class="of-group">
          <label class="of-label">–°—Å—ã–ª–∫–∞ –Ω–∞ –±–∏–∑–Ω–µ—Å (–Ø–Ω–¥–µ–∫—Å –∫–∞—Ä—Ç—ã, Instagram, 2–ì–ò–°)</label>
          <input class="of-input" id="ofLink" placeholder="https://..." type="url">
        </div>

        <button class="of-submit" id="ofSubmit" onclick="submitOrder()">
          ü§ñ –ù–∞—á–∞—Ç—å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Å AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º
        </button>
        <div style="text-align:center;margin-top:10px;font-size:12px;color:var(--text3)">
          –ë–µ—Å–ø–ª–∞—Ç–Ω–æ –∏ –±–µ–∑ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤. AI –∑–∞–¥–∞—Å—Ç —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã.
        </div>
      </div>
    </div>

    <!-- Portfolio -->
    <div class="portfolio-section" id="portfolio">
      <div class="section-title">–ù–∞—à–∏ —Ä–∞–±–æ—Ç—ã</div>
      <div class="section-sub">–ü—Ä–∏–º–µ—Ä—ã —Å–∞–π—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º—ã —Å–æ–∑–¥–∞–ª–∏</div>
      <div class="portfolio-grid" id="portfolioGrid"></div>
    </div>

    <!-- FAQ -->
    <div class="faq-section">
      <div class="section-title">–ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã</div>
      <div class="section-sub">–û—Ç–≤–µ—Ç—ã –Ω–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã</div>
      <div id="faqList"></div>
    </div>

    <!-- Footer -->
    <div class="footer">
      ¬© 2025 –í–µ–±-—Å—Ç—É–¥–∏—è ¬∑ <a href="#" style="color:var(--accent);text-decoration:none">Telegram</a>
    </div>
  </div>

</div>

<!-- ‚ïê‚ïê‚ïê AI CHAT SCREEN ‚ïê‚ïê‚ïê -->
<div class="chat-screen" id="chatScreen">
  <div class="chat-header">
    <button class="chat-back" onclick="backToLanding()">‚Üê</button>
    <div style="width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--pink));display:flex;align-items:center;justify-content:center;font-size:18px">ü§ñ</div>
    <div class="chat-info">
      <div class="chat-name">AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç</div>
      <div class="chat-status" id="chatStatus">‚óè –æ–Ω–ª–∞–π–Ω</div>
    </div>
  </div>
  <div class="chat-progress">
    <div class="cp-row">
      <span>–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∞–Ω–∫–µ—Ç—ã</span>
      <span id="cpPct">0%</span>
    </div>
    <div class="cp-bar"><div class="cp-fill" id="cpFill" style="width:0%"></div></div>
  </div>
  <div class="chat-messages" id="chatMessages"></div>
  <div class="media-preview" id="mediaPreview"></div>
  <div class="chat-input-area">
    <button class="chat-attach" onclick="attachFiles()">üìé</button>
    <textarea class="chat-textarea" id="chatInput" rows="1" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –æ—Ç–≤–µ—Ç..." 
      oninput="autoResize(this)" 
      onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendMessage()}"></textarea>
    <button class="chat-send" id="chatSendBtn" onclick="sendMessage()">‚û§</button>
    <input type="file" id="fileInput" multiple accept="image/*,.pdf,.doc,.docx" style="display:none" onchange="filesSelected(this)">
  </div>
</div>

<!-- Preview Modal -->
<div class="preview-overlay" id="previewOverlay" onclick="if(event.target===this)closePreview()">
  <div class="preview-modal" id="previewModal"></div>
</div>

<!-- Toast -->
<div class="toast-msg" id="toastEl"></div>

<script>
// ‚ïê‚ïê‚ïê CONFIG ‚ïê‚ïê‚ïê
const SUPABASE_URL = 'https://prparzgqevfelwsndmkc.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBycGFyemdxZXZmZWx3c25kbWtjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM1MTM5NDIsImV4cCI6MjA1OTA4OTk0Mn0.D3xHFWu7WwVsLZMh-vs-Hv2Fo8k1GFoFQXOLuJ3i6Ew';
const AI_URL = 'https://daniyal2212.app.n8n.cloud/webhook/rkt-ai';

const SB = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const PRICING = {
  '–í–∏–∑–∏—Ç–∫–∞': {
    price: 5000, emoji: 'üìÑ', desc: '1‚Äì3 —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –±–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', badge: '',
    full_desc: '–ü—Ä–æ—Å—Ç–æ–π –∏ —ç–ª–µ–≥–∞–Ω—Ç–Ω—ã–π —Å–∞–π—Ç —Å –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –≤–∞—à–µ–º –±–∏–∑–Ω–µ—Å–µ. –ò–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –∫–∞–∫ —Ü–∏—Ñ—Ä–æ–≤–∞—è –≤–∏–∑–∏—Ç–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ ‚Äî –∫–ª–∏–µ–Ω—Ç—ã –Ω–∞–π–¥—É—Ç –≤–∞—Å –≤ Google, —É–∑–Ω–∞—é—Ç –∫–æ–Ω—Ç–∞–∫—Ç—ã –∏ —á–∞—Å—ã —Ä–∞–±–æ—Ç—ã.',
    features: [
      ['üì±', '–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω (—Ç–µ–ª–µ—Ñ–æ–Ω + –∫–æ–º–ø—å—é—Ç–µ—Ä)'],
      ['üìç', '–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –∞–¥—Ä–µ—Å–æ–º –∏ –∫–∞—Ä—Ç–æ–π'],
      ['üìû', '–ö–Ω–æ–ø–∫–∏ –∑–≤–æ–Ω–∫–∞ –∏ WhatsApp'],
      ['üïê', '–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã –∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã'],
      ['üé®', '1‚Äì3 —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –≤–∞—à–∏–º —Å—Ç–∏–ª–µ–º'],
      ['üîç', '–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –≤ –ø–æ–∏—Å–∫–æ–≤–∏–∫–∞—Ö']
    ],
    audience: '–ú–∞—Å—Ç–µ—Ä–∞, —Ñ—Ä–∏–ª–∞–Ω—Å–µ—Ä—ã, –Ω–µ–±–æ–ª—å—à–∏–µ –º–∞—Å—Ç–µ—Ä—Å–∫–∏–µ, —Ç–æ—á–∫–∏ —É—Å–ª—É–≥, –∫–æ—Ñ–µ–π–Ω–∏ ‚Äî –≤—Å–µ, –∫–æ–º—É –Ω—É–∂–Ω–æ –±–∞–∑–æ–≤–æ–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ.',
    timeline: '1‚Äì2 –¥–Ω—è',
    mockup: {
      url: '–º–æ–π-–±–∏–∑–Ω–µ—Å.—Ä—Ñ',
      bg: 'linear-gradient(180deg, #1a1a2e 0%, #16213e 40%, #0f3460 100%)',
      sections: [
        { type: 'header', text: '–ë–∞—Ä–±–µ—Ä—à–æ–ø ¬´–ë—Ä–∏—Ç–≤–∞¬ª', sub: '–ú—É–∂—Å–∫–∏–µ —Å—Ç—Ä–∏–∂–∫–∏ ¬∑ –ë–æ—Ä–æ–¥—ã ¬∑ –£–∫–ª–∞–¥–∫–∏' },
        { type: 'info', items: ['üìç —É–ª. –ü—É—à–∫–∏–Ω–∞, 15', 'üìû +7 (999) 123-45-67', 'üïê –ü–Ω‚Äì–°–± 10:00‚Äì21:00'] },
        { type: 'cta', text: 'üìû –ó–∞–ø–∏—Å–∞—Ç—å—Å—è' }
      ]
    }
  },
  '–õ–µ–Ω–¥–∏–Ω–≥': {
    price: 10000, emoji: 'üéØ', desc: '–ü—Ä–æ–¥–∞—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –∞–Ω–∏–º–∞—Ü–∏—è–º–∏', badge: '–ü–æ–ø—É–ª—è—Ä–Ω—ã–π',
    full_desc: '–û–¥–Ω–∞ –º–æ—â–Ω–∞—è –ø—Ä–æ–¥–∞—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞, –∫–æ—Ç–æ—Ä–∞—è —É–±–µ–∂–¥–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –≤–∞–º. –° –∫—Ä–∞—Å–∏–≤—ã–º–∏ –∞–Ω–∏–º–∞—Ü–∏—è–º–∏, –±–ª–æ–∫–∞–º–∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤, –æ—Ç–∑—ã–≤–∞–º–∏ –∏ —Ñ–æ—Ä–º–æ–π –∑–∞—è–≤–∫–∏. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π –≤ –∫–ª–∏–µ–Ω—Ç–æ–≤.',
    features: [
      ['üéØ', '–ü—Ä–æ–¥–∞—é—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–∞—è)'],
      ['‚ú®', '–ê–Ω–∏–º–∞—Ü–∏–∏ –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ'],
      ['üí¨', '–§–æ—Ä–º–∞ –∑–∞—è–≤–∫–∏ / –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–∞'],
      ['‚≠ê', '–ë–ª–æ–∫ –æ—Ç–∑—ã–≤–æ–≤ –∫–ª–∏–µ–Ω—Ç–æ–≤'],
      ['üìä', '–ë–ª–æ–∫–∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤ –∏ —É—Å–ª—É–≥'],
      ['üì±', '–ò–¥–µ–∞–ª—å–Ω—ã–π –≤–∏–¥ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ'],
      ['üöÄ', '–ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (< 2 —Å–µ–∫)'],
      ['üìà', '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∏']
    ],
    audience: '–ö–∞—Ñ–µ, —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã, —Å–∞–ª–æ–Ω—ã –∫—Ä–∞—Å–æ—Ç—ã, –∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å—ã, –¥–æ—Å—Ç–∞–≤–∫–∏ ‚Äî –±–∏–∑–Ω–µ—Å, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—á–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –∑–∞—è–≤–∫–∏ —Å —Å–∞–π—Ç–∞.',
    timeline: '2‚Äì3 –¥–Ω—è',
    mockup: {
      url: '–≤–∫—É—Å–Ω–∞—è-–¥–æ—Å—Ç–∞–≤–∫–∞.—Ä—Ñ',
      bg: 'linear-gradient(180deg, #ff6b35 0%, #f7c59f 30%, #fff 50%)',
      sections: [
        { type: 'header', text: 'üçï –î–æ—Å—Ç–∞–≤–∫–∞ –∑–∞ 30 –º–∏–Ω—É—Ç', sub: '–ü–∏—Ü—Ü–∞ ¬∑ –†–æ–ª–ª—ã ¬∑ –ë—É—Ä–≥–µ—Ä—ã ‚Äî –≥–æ—Ä—è—á–∏–µ –∏ —Å–≤–µ–∂–∏–µ!' },
        { type: 'features', items: ['üöó –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞', '‚è∞ 30 –º–∏–Ω—É—Ç –∏–ª–∏ –±–µ—Å–ø–ª–∞—Ç–Ω–æ', '‚≠ê 4.9 –Ω–∞ –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç–∞—Ö'] },
        { type: 'cta', text: 'üõí –°–º–æ—Ç—Ä–µ—Ç—å –º–µ–Ω—é' }
      ]
    }
  },
  '–ö–∞—Ç–∞–ª–æ–≥': {
    price: 15000, emoji: 'üõí', desc: '5+ —Å—Ç—Ä–∞–Ω–∏—Ü, –∫–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤/—É—Å–ª—É–≥', badge: '',
    full_desc: '–ú–Ω–æ–≥–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã–π —Å–∞–π—Ç —Å –ø–æ–ª–Ω—ã–º –∫–∞—Ç–∞–ª–æ–≥–æ–º –≤–∞—à–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤ –∏–ª–∏ —É—Å–ª—É–≥. –ö–∞–∂–¥–∞—è –ø–æ–∑–∏—Ü–∏—è ‚Äî —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º, —Ñ–æ—Ç–æ –∏ —Ü–µ–Ω–æ–π. –£–¥–æ–±–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫. –ö–ª–∏–µ–Ω—Ç—ã –º–æ–≥—É—Ç –≤—ã–±—Ä–∞—Ç—å –∏ —Å—Ä–∞–∑—É –ø–æ–∑–≤–æ–Ω–∏—Ç—å.',
    features: [
      ['üõí', '–ö–∞—Ç–∞–ª–æ–≥ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏'],
      ['üì∑', '–§–æ—Ç–æ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏'],
      ['üí∞', '–¶–µ–Ω—ã –∏ —Ñ–∏–ª—å—Ç—Ä—ã'],
      ['üîç', '–ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–∞–ª–æ–≥—É'],
      ['üìÑ', '5‚Äì15 —Å—Ç—Ä–∞–Ω–∏—Ü'],
      ['üì±', '–£–¥–æ–±–Ω–æ –ª–∏—Å—Ç–∞—Ç—å –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ'],
      ['üìû', '–ö–Ω–æ–ø–∫–∞ –∑–∞–∫–∞–∑–∞ / –∑–≤–æ–Ω–∫–∞'],
      ['üóÇÔ∏è', '–°—Ç—Ä–∞–Ω–∏—Ü–∞ ¬´–û –Ω–∞—Å¬ª + –ö–æ–Ω—Ç–∞–∫—Ç—ã']
    ],
    audience: '–ú–∞–≥–∞–∑–∏–Ω—ã, –∞–≤—Ç–æ–∑–∞–ø—á–∞—Å—Ç–∏, –º–µ–±–µ–ª—å–Ω—ã–µ —Å–∞–ª–æ–Ω—ã, –æ–ø—Ç–æ–≤—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ ‚Äî –±–∏–∑–Ω–µ—Å —Å –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–æ–º —Ç–æ–≤–∞—Ä–æ–≤ –∏–ª–∏ —É—Å–ª—É–≥.',
    timeline: '3‚Äì5 –¥–Ω–µ–π',
    mockup: {
      url: '–º–µ–±–µ–ª—å-–¥–æ–º.—Ä—Ñ/–∫–∞—Ç–∞–ª–æ–≥',
      bg: 'linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%)',
      sections: [
        { type: 'header', text: '–ú–µ–±–µ–ª—å –¥–ª—è –¥–æ–º–∞', sub: '–ö–∞—Ç–∞–ª–æ–≥ ¬∑ 240 –ø–æ–∑–∏—Ü–∏–π', dark: true },
        { type: 'grid', items: ['üõãÔ∏è –î–∏–≤–∞–Ω—ã\n‚ÇΩ–æ—Ç 25 000', 'ü™ë –°—Ç—É–ª—å—è\n‚ÇΩ–æ—Ç 3 500', 'üõèÔ∏è –ö—Ä–æ–≤–∞—Ç–∏\n‚ÇΩ–æ—Ç 18 000', 'üóÑÔ∏è –®–∫–∞—Ñ—ã\n‚ÇΩ–æ—Ç 12 000'] },
        { type: 'cta', text: 'üìû –ó–∞–∫–∞–∑–∞—Ç—å' }
      ]
    }
  },
  '–ü—Ä–µ–º–∏—É–º': {
    price: 25000, emoji: '‚≠ê', desc: '–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω, SEO, CRM', badge: '',
    full_desc: '–ü–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π —Å–∞–π—Ç —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –¥–∏–∑–∞–π–Ω–æ–º –ø–æ–¥ –≤–∞—à –±—Ä–µ–Ω–¥. SEO-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –≤—ã—Ö–æ–¥–∞ –≤ —Ç–æ–ø –ø–æ–∏—Å–∫–∞. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CRM, –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.',
    features: [
      ['üé®', '–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω —Å –Ω—É–ª—è'],
      ['üîç', 'SEO-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–¢–û–ü –Ø–Ω–¥–µ–∫—Å–∞)'],
      ['üìä', 'CRM + –∞–Ω–∞–ª–∏—Ç–∏–∫–∞'],
      ['üìÖ', '–û–Ω–ª–∞–π–Ω-–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ / –∑–∞–ø–∏—Å—å'],
      ['üí≥', '–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ–ø–ª–∞—Ç—ã'],
      ['üì±', 'PWA (—Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)'],
      ['üîí', 'SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç'],
      ['üõ†Ô∏è', '–ü–æ–¥–¥–µ—Ä–∂–∫–∞ 30 –¥–Ω–µ–π']
    ],
    audience: '–†–µ—Å—Ç–æ—Ä–∞–Ω—ã, –∫–ª–∏–Ω–∏–∫–∏, –æ—Ç–µ–ª–∏, –∫—Ä—É–ø–Ω—ã–µ —Å–∞–ª–æ–Ω—ã ‚Äî –±–∏–∑–Ω–µ—Å, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ —Å–∞–π—Ç —ç—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞–Ω–∞–ª –∫–ª–∏–µ–Ω—Ç–æ–≤.',
    timeline: '5‚Äì10 –¥–Ω–µ–π',
    mockup: {
      url: '—Ä–µ—Å—Ç–æ–∫–ª—É–±-–±—Ä–µ–∂–Ω–µ–≤.—Ä—Ñ',
      bg: 'linear-gradient(180deg, #0c0c0c 0%, #1a1a2e 40%, #2d2d44 100%)',
      sections: [
        { type: 'header', text: '–†–ï–°–¢–û–ö–õ–£–ë –ë–†–ï–ñ–ù–ï–í', sub: '–ê–≤—Ç–æ—Ä—Å–∫–∞—è –∫—É—Ö–Ω—è ¬∑ –í–∏–Ω–Ω–∞—è –∫–∞—Ä—Ç–∞ ¬∑ –ñ–∏–≤–∞—è –º—É–∑—ã–∫–∞' },
        { type: 'features', items: ['üìÖ –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–æ–ª', 'üìñ –ú–µ–Ω—é –∏ —Ü–µ–Ω—ã', 'üéµ –ê—Ñ–∏—à–∞ —Å–æ–±—ã—Ç–∏–π'] },
        { type: 'cta', text: 'üìÖ –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å' }
      ]
    }
  },
  '–°–≤–∞–¥–µ–±–Ω—ã–π': {
    price: 8000, emoji: 'üíç', desc: '–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ, RSVP, —Ñ–æ—Ç–æ–≥–∞–ª–µ—Ä–µ—è', badge: '',
    full_desc: '–ö—Ä–∞—Å–∏–≤—ã–π —Å–≤–∞–¥–µ–±–Ω—ã–π —Å–∞–π—Ç-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ —Å —Ç–∞–π–º–µ—Ä–æ–º –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á—ë—Ç–∞, —Ñ–æ—Ç–æ–≥–∞–ª–µ—Ä–µ–µ–π, –∫–∞—Ä—Ç–æ–π –ø—Ä–æ–µ–∑–¥–∞ –∏ —Ñ–æ—Ä–º–æ–π –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (RSVP). –ì–æ—Å—Ç–∏ –ø–æ–ª—É—á–∞—é—Ç —Å—Å—ã–ª–∫—É –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ –æ–Ω–ª–∞–π–Ω.',
    features: [
      ['üíí', '–ö—Ä–∞—Å–∏–≤—ã–π –¥–∏–∑–∞–π–Ω-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ'],
      ['‚è∞', '–¢–∞–π–º–µ—Ä –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á—ë—Ç–∞'],
      ['üì∏', '–§–æ—Ç–æ–≥–∞–ª–µ—Ä–µ—è –ø–∞—Ä—ã'],
      ['‚úÖ', 'RSVP ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≥–æ—Å—Ç–µ–π'],
      ['üìç', '–ö–∞—Ä—Ç–∞ –ø—Ä–æ–µ–∑–¥–∞ –¥–æ –º–µ—Å—Ç–∞'],
      ['üìã', '–ü—Ä–æ–≥—Ä–∞–º–º–∞ –¥–Ω—è'],
      ['üíê', '–°–ø–∏—Å–æ–∫ –∂–µ–ª–∞–Ω–∏–π / –ø–æ–¥–∞—Ä–∫–æ–≤'],
      ['üéµ', '–§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞']
    ],
    audience: '–ü–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç—è—Ç —Å—Ç–∏–ª—å–Ω–æ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å –≥–æ—Å—Ç–µ–π –∏ —Å–æ–±—Ä–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–Ω–ª–∞–π–Ω –≤–º–µ—Å—Ç–æ –±—É–º–∞–∂–Ω—ã—Ö –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π.',
    timeline: '2‚Äì3 –¥–Ω—è',
    mockup: {
      url: '–∞–Ω—è-–∏-–¥–∏–º–∞.—Ä—Ñ',
      bg: 'linear-gradient(180deg, #fdf2f8 0%, #fce7f3 30%, #fbcfe8 100%)',
      sections: [
        { type: 'header', text: '–ê–Ω—è & –î–∏–º–∞', sub: '15 –∞–≤–≥—É—Å—Ç–∞ 2025 ¬∑ –ú–æ—Å–∫–≤–∞', dark: true },
        { type: 'features', items: ['‚è∞ –î–æ —Å–≤–∞–¥—å–±—ã: 142 –¥–Ω—è', 'üìç –£—Å–∞–¥—å–±–∞ ¬´–ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫–æ–µ¬ª', '‚úÖ 48 –∏–∑ 60 –≥–æ—Å—Ç–µ–π'] },
        { type: 'cta', text: '‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ', dark: true }
      ]
    }
  },
  '–ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ': {
    price: 7000, emoji: 'üé®', desc: '–ì–∞–ª–µ—Ä–µ—è —Ä–∞–±–æ—Ç, —Ä–µ–∑—é–º–µ, –∫–æ–Ω—Ç–∞–∫—Ç—ã', badge: '',
    full_desc: '–°—Ç–∏–ª—å–Ω—ã–π —Å–∞–π—Ç –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –≤–∞—à–∏—Ö —Ä–∞–±–æ—Ç –∏ –Ω–∞–≤—ã–∫–æ–≤. –ì–∞–ª–µ—Ä–µ—è –ø—Ä–æ–µ–∫—Ç–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—Å, –Ω–∞–≤—ã–∫–∏ –∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã. –ü—Ä–æ–∏–∑–≤–µ–¥–∏—Ç–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–µ–π.',
    features: [
      ['üñºÔ∏è', '–ì–∞–ª–µ—Ä–µ—è —Ä–∞–±–æ—Ç —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏'],
      ['üë§', '–°—Ç—Ä–∞–Ω–∏—Ü–∞ ¬´–û–±–æ –º–Ω–µ¬ª'],
      ['üèÜ', '–ù–∞–≤—ã–∫–∏ –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è'],
      ['üì¨', '–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è —Ñ–æ—Ä–º–∞'],
      ['üîó', '–°—Å—ã–ª–∫–∏ –Ω–∞ —Å–æ—Ü—Å–µ—Ç–∏'],
      ['üì±', '–ö—Ä–∞—Å–∏–≤–æ –Ω–∞ –ª—é–±–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ']
    ],
    audience: '–§–æ—Ç–æ–≥—Ä–∞—Ñ—ã, –¥–∏–∑–∞–π–Ω–µ—Ä—ã, —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏, —Ñ—Ä–∏–ª–∞–Ω—Å–µ—Ä—ã ‚Äî –≤—Å–µ, –∫—Ç–æ —Ö–æ—á–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å —Å–≤–æ–∏ —Ä–∞–±–æ—Ç—ã –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–∞–º.',
    timeline: '2‚Äì3 –¥–Ω—è',
    mockup: {
      url: 'anna-photo.ru',
      bg: 'linear-gradient(180deg, #f5f5f5 0%, #e0e0e0 100%)',
      sections: [
        { type: 'header', text: '–ê–Ω–Ω–∞ –§–æ—Ç–æ–≥—Ä–∞—Ñ', sub: '–°–≤–∞–¥—å–±—ã ¬∑ –ü–æ—Ä—Ç—Ä–µ—Ç—ã ¬∑ –†–µ–ø–æ—Ä—Ç–∞–∂–∏', dark: true },
        { type: 'grid', items: ['üì∑ –°–≤–∞–¥—å–±—ã\n45 —Ä–∞–±–æ—Ç', 'üì∏ –ü–æ—Ä—Ç—Ä–µ—Ç—ã\n32 —Ä–∞–±–æ—Ç—ã', 'üé• –†–µ–ø–æ—Ä—Ç–∞–∂–∏\n18 —Ä–∞–±–æ—Ç', 'üèôÔ∏è –ì–æ—Ä–æ–¥—Å–∫–∏–µ\n27 —Ä–∞–±–æ—Ç'] },
        { type: 'cta', text: 'üì¨ –ù–∞–ø–∏—Å–∞—Ç—å', dark: true }
      ]
    }
  },
  '–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ': {
    price: 8000, emoji: 'üéâ', desc: '–°–æ–±—ã—Ç–∏–µ, –ø—Ä–æ–≥—Ä–∞–º–º–∞, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è', badge: '',
    full_desc: '–ü—Ä–æ–º–æ-—Å–∞–π—Ç –¥–ª—è –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏, –∫–æ–Ω—Ü–µ—Ä—Ç–∞, –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å–∞ –∏–ª–∏ –ª—é–±–æ–≥–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è. –ü—Ä–æ–≥—Ä–∞–º–º–∞, —Å–ø–∏–∫–µ—Ä—ã, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏ —Ç–∞–π–º–µ—Ä –¥–æ —Å–æ–±—ã—Ç–∏—è.',
    features: [
      ['üìã', '–ü—Ä–æ–≥—Ä–∞–º–º–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è'],
      ['üé§', '–°–ø–∏–∫–µ—Ä—ã / —É—á–∞—Å—Ç–Ω–∏–∫–∏'],
      ['üéüÔ∏è', '–û–Ω–ª–∞–π–Ω-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è'],
      ['‚è∞', '–¢–∞–π–º–µ—Ä –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á—ë—Ç–∞'],
      ['üìç', '–ú–µ—Å—Ç–æ –∏ –∫–∞—Ä—Ç–∞ –ø—Ä–æ–µ–∑–¥–∞'],
      ['üì∏', '–§–æ—Ç–æ–≥–∞–ª–µ—Ä–µ—è –ø—Ä–æ—à–ª—ã—Ö —Å–æ–±—ã—Ç–∏–π']
    ],
    audience: '–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä—ã –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–π, –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å–æ–≤, –∫–æ–Ω—Ü–µ—Ä—Ç–æ–≤, —Ñ–µ—Å—Ç–∏–≤–∞–ª–µ–π ‚Äî –ª—é–±–æ–µ —Å–æ–±—ã—Ç–∏–µ —Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π.',
    timeline: '2‚Äì3 –¥–Ω—è',
    mockup: {
      url: 'tech-conf-2025.—Ä—Ñ',
      bg: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
      sections: [
        { type: 'header', text: 'TechConf 2025', sub: '20 –º–∞—Ä—Ç–∞ ¬∑ –ú–æ—Å–∫–≤–∞ ¬∑ 500 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤' },
        { type: 'features', items: ['üé§ 12 —Å–ø–∏–∫–µ—Ä–æ–≤', 'üìã 8 –¥–æ–∫–ª–∞–¥–æ–≤', 'üéüÔ∏è –û—Å—Ç–∞–ª–æ—Å—å 47 –º–µ—Å—Ç'] },
        { type: 'cta', text: 'üéüÔ∏è –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è' }
      ]
    }
  },
  '–ë–ª–æ–≥/–ú–µ–¥–∏–∞': {
    price: 10000, emoji: 'üì∞', desc: '–ë–ª–æ–≥, —Å—Ç–∞—Ç—å–∏, –º–µ–¥–∏–∞–∫–æ–Ω—Ç–µ–Ω—Ç', badge: '',
    full_desc: '–ö–æ–Ω—Ç–µ–Ω—Ç–Ω—ã–π —Å–∞–π—Ç –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å—Ç–∞—Ç–µ–π, –Ω–æ–≤–æ—Å—Ç–µ–π –∏ –º–µ–¥–∏–∞–º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤. –£–¥–æ–±–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –ø–æ–∏—Å–∫ –ø–æ —Å—Ç–∞—Ç—å—è–º. –ü—Ä–∏–≤–ª–µ–∫–∞–µ—Ç –æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏–π —Ç—Ä–∞—Ñ–∏–∫ –∏–∑ –ø–æ–∏—Å–∫–æ–≤–∏–∫–æ–≤.',
    features: [
      ['‚úèÔ∏è', '–£–¥–æ–±–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Å—Ç–∞—Ç–µ–π'],
      ['üóÇÔ∏è', '–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ç–µ–≥–∏'],
      ['üîç', '–ü–æ–∏—Å–∫ –ø–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É'],
      ['üì±', '–ß–∏—Ç–∞–±–µ–ª—å–Ω–æ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ'],
      ['üìà', 'SEO –¥–ª—è –æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞'],
      ['üí¨', '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ / –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å']
    ],
    audience: '–ë–ª–æ–≥–µ—Ä—ã, —ç–∫—Å–ø–µ—Ä—Ç—ã, –º–µ–¥–∏–∞-–ø—Ä–æ–µ–∫—Ç—ã, –∫–æ–º–ø–∞–Ω–∏–∏ —Å –∫–æ–Ω—Ç–µ–Ω—Ç-–º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–º ‚Äî –≤—Å–µ, –∫—Ç–æ –ø—É–±–ª–∏–∫—É–µ—Ç —Ä–µ–≥—É–ª—è—Ä–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç.',
    timeline: '3‚Äì4 –¥–Ω—è',
    mockup: {
      url: '–±–ª–æ–≥-—ç–∫—Å–ø–µ—Ä—Ç.—Ä—Ñ',
      bg: 'linear-gradient(180deg, #fff 0%, #f8f9fa 100%)',
      sections: [
        { type: 'header', text: '–ë–ª–æ–≥ –≠–∫—Å–ø–µ—Ä—Ç–∞', sub: '–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ ¬∑ –ë–∏–∑–Ω–µ—Å ¬∑ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏', dark: true },
        { type: 'grid', items: ['üìÑ –ö–∞–∫ –ø—Ä–∏–≤–ª–µ—á—å\n–∫–ª–∏–µ–Ω—Ç–æ–≤', 'üìÑ 5 —Ç—Ä–µ–Ω–¥–æ–≤\n2025 –≥–æ–¥–∞', 'üìÑ SEO –¥–ª—è\n–Ω–æ–≤–∏—á–∫–æ–≤', 'üìÑ –†–µ–∫–ª–∞–º–∞\n–≤ —Å–æ—Ü—Å–µ—Ç—è—Ö'] },
        { type: 'cta', text: 'üì© –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è', dark: true }
      ]
    }
  }
};

const FAQ_DATA = [
  { q: '–°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–Ω–∏–º–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ —Å–∞–π—Ç–∞?', a: '–°–∞–π—Ç-–≤–∏–∑–∏—Ç–∫–∞ ‚Äî 1‚Äì2 –¥–Ω—è, –ª–µ–Ω–¥–∏–Ω–≥ ‚Äî 2‚Äì3 –¥–Ω—è, –∫–∞—Ç–∞–ª–æ–≥ ‚Äî 3‚Äì5 –¥–Ω–µ–π. –ú—ã –Ω–∞—á–∏–Ω–∞–µ–º —Ä–∞–±–æ—Ç—É —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞.' },
  { q: '–ß—Ç–æ –≤—Ö–æ–¥–∏—Ç –≤ —Å—Ç–æ–∏–º–æ—Å—Ç—å?', a: '–î–∏–∑–∞–π–Ω, –≤—ë—Ä—Å—Ç–∫–∞, –∞–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –º–æ–±–∏–ª—å–Ω—ã–µ, –±–∞–∑–æ–≤–∞—è SEO-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞, —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥–µ. –î–æ–º–µ–Ω –∏ —Ö–æ—Å—Ç–∏–Ω–≥ –Ω–∞ –≥–æ–¥ ‚Äî –æ—Ç–¥–µ–ª—å–Ω–æ –∑–∞ 3 000‚ÇΩ.' },
  { q: '–ù—É–∂–Ω–æ –ª–∏ –º–Ω–µ —á—Ç–æ-—Ç–æ –¥–µ–ª–∞—Ç—å?', a: '–ú–∏–Ω–∏–º—É–º! AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –∑–∞–¥–∞—Å—Ç –≤–æ–ø—Ä–æ—Å—ã –æ –≤–∞—à–µ–º –±–∏–∑–Ω–µ—Å–µ, –∞ –≤—ã –ø—Ä–æ—Å—Ç–æ –æ—Ç–≤–µ—Ç–∏—Ç–µ. –ú–æ–∂–Ω–æ –ø—Ä–∏—Å–ª–∞—Ç—å —Ñ–æ—Ç–æ ‚Äî –∏ –º—ã —Å–¥–µ–ª–∞–µ–º –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ.' },
  { q: '–ú–æ–∂–Ω–æ –ª–∏ –≤–Ω–æ—Å–∏—Ç—å –ø—Ä–∞–≤–∫–∏?', a: '–î–∞, –æ–¥–Ω–∞ –∏—Ç–µ—Ä–∞—Ü–∏—è –ø—Ä–∞–≤–æ–∫ –≤—Ö–æ–¥–∏—Ç –≤ —Å—Ç–æ–∏–º–æ—Å—Ç—å. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∫–∏ ‚Äî –ø–æ –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏.' },
  { q: '–ö–∞–∫–∏–µ —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã?', a: '–ü–µ—Ä–µ–≤–æ–¥ –Ω–∞ –∫–∞—Ä—Ç—É, –ø–æ —Å—á—ë—Ç—É –¥–ª—è —é—Ä–ª–∏—Ü. –û–ø–ª–∞—Ç–∞ –ø–æ—Å–ª–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –º–∞–∫–µ—Ç–∞ ‚Äî –Ω–∏–∫–∞–∫–∏—Ö –ø—Ä–µ–¥–æ–ø–ª–∞—Ç.' },
  { q: '–ß—Ç–æ –µ—Å–ª–∏ –º–Ω–µ –Ω–µ –ø–æ–Ω—Ä–∞–≤–∏—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç?', a: '–ú—ã –ø–æ–∫–∞–∂–µ–º –¥–µ–º–æ-–≤–µ—Ä—Å–∏—é —Å–∞–π—Ç–∞ –¥–æ –æ–ø–ª–∞—Ç—ã. –ï—Å–ª–∏ –Ω–µ –ø–æ–¥–æ–π–¥—ë—Ç ‚Äî –≤—ã –Ω–∏—á–µ–≥–æ –Ω–µ –ø–ª–∞—Ç–∏—Ç–µ.' }
];

const PORTFOLIO_DATA = [
  { name: '–ü—ã—à–∫–∏ –º–∏—Ä–∞', desc: '–†–µ—Å—Ç–æ—Ä–∞–Ω ‚Äî –∫–∞—Ç–∞–ª–æ–≥ –º–µ–Ω—é + –¥–æ—Å—Ç–∞–≤–∫–∞', emoji: 'üç©' },
  { name: '–†–µ—Å—Ç–æ–∫–ª—É–± –ë—Ä–µ–∂–Ω–µ–≤', desc: '–†–µ—Å—Ç–æ—Ä–∞–Ω ‚Äî –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ + –º–µ–Ω—é', emoji: 'üçΩÔ∏è' },
  { name: '–ö–µ—Ä–∞—Ç–∏–Ω –ê–≥—Ä—ã–∑', desc: '–°–∞–ª–æ–Ω –∫—Ä–∞—Å–æ—Ç—ã ‚Äî —É—Å–ª—É–≥–∏ + –∑–∞–ø–∏—Å—å', emoji: 'üíá' }
];

// ‚ïê‚ïê‚ïê STATE ‚ïê‚ïê‚ïê
let selectedType = '';
let currentDir = null;
let clientToken = '';
let chatHistory = [];
let pendingFiles = [];
let sending = false;

// ‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê
document.addEventListener('DOMContentLoaded', () => {
  renderPricing();
  renderFAQ();
  renderPortfolio();
  populateTypeSelect();

  // Check for token in URL
  const params = new URLSearchParams(window.location.search);
  const token = params.get('token') || params.get('client');

  if (token) {
    loadExistingClient(token);
  } else {
    hideLoading();
  }
});

function hideLoading() {
  const el = document.getElementById('loadingScreen');
  el.style.opacity = '0';
  setTimeout(() => el.style.display = 'none', 300);
}

// ‚ïê‚ïê‚ïê RENDER PRICING ‚ïê‚ïê‚ïê
function renderPricing() {
  const grid = document.getElementById('pricingGrid');
  let html = '';
  for (const [name, p] of Object.entries(PRICING)) {
    html += `<div class="price-card" data-type="${esc(name)}">
      ${p.badge ? '<div class="pc-badge">' + p.badge + '</div>' : ''}
      <span class="pc-emoji">${p.emoji}</span>
      <div class="pc-name">${esc(name)}</div>
      <div class="pc-desc">${esc(p.desc)}</div>
      <div class="pc-price">${p.price.toLocaleString('ru')}‚ÇΩ</div>
      <div class="pc-info" onclick="event.stopPropagation();showPreview('${esc(name)}')">üëÅ –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–∏–º–µ—Ä</div>
    </div>`;
    // Card click selects pricing
    setTimeout(() => {
      const card = document.querySelector(`.price-card[data-type="${name}"]`);
      if (card) card.addEventListener('click', (e) => {
        if (e.target.closest('.pc-info')) return;
        selectPricing(name);
      });
    }, 0);
  }
  grid.innerHTML = html;
}

function selectPricing(type) {
  selectedType = type;
  // Highlight card
  document.querySelectorAll('.price-card').forEach(c => c.classList.remove('selected'));
  const card = document.querySelector(`.price-card[data-type="${type}"]`);
  if (card) card.classList.add('selected');

  // Update form
  const p = PRICING[type];
  document.getElementById('selectedTypeBlock').style.display = 'block';
  document.getElementById('selectedTypeBlock').innerHTML = `
    <div class="of-selected-type">
      <div class="emoji">${p.emoji}</div>
      <div class="info">
        <div class="name">${esc(type)}</div>
        <div class="price">${p.price.toLocaleString('ru')}‚ÇΩ ¬∑ ${esc(p.desc)}</div>
      </div>
      <button class="change" onclick="clearSelection()">–ò–∑–º–µ–Ω–∏—Ç—å</button>
    </div>`;
  document.getElementById('typeSelectGroup').style.display = 'none';
  document.getElementById('ofType').value = type;

  // Scroll to form
  document.getElementById('order').scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function clearSelection() {
  selectedType = '';
  document.querySelectorAll('.price-card').forEach(c => c.classList.remove('selected'));
  document.getElementById('selectedTypeBlock').style.display = 'none';
  document.getElementById('typeSelectGroup').style.display = 'block';
  document.getElementById('ofType').value = '';
}

// ‚ïê‚ïê‚ïê PREVIEW MODAL ‚ïê‚ïê‚ïê
function showPreview(type) {
  const p = PRICING[type];
  if (!p) return;

  const modal = document.getElementById('previewModal');
  let html = '';

  // Close button
  html += '<button class="pm-close" onclick="closePreview()">‚úï</button>';

  // Hero
  html += '<div class="pm-hero">';
  html += '<div class="pm-hero-top">';
  html += '<div class="pm-emoji">' + p.emoji + '</div>';
  html += '<div>';
  html += '<div class="pm-title">' + esc(type) + '</div>';
  html += '<div class="pm-subtitle">' + esc(p.full_desc) + '</div>';
  html += '<div class="pm-price-row"><span class="pm-price">' + p.price.toLocaleString('ru') + '‚ÇΩ</span><span class="pm-price-note">¬∑ –≥–æ—Ç–æ–≤–æ –∑–∞ ' + esc(p.timeline) + '</span></div>';
  html += '</div></div></div>';

  // Body
  html += '<div class="pm-body">';

  // Mockup
  html += '<div class="pm-section">';
  html += '<div class="pm-section-title">üì± –ö–∞–∫ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç</div>';
  html += renderMockup(p.mockup, type);
  html += '</div>';

  // Features
  html += '<div class="pm-section">';
  html += '<div class="pm-section-title">‚úÖ –ß—Ç–æ –≤—Ö–æ–¥–∏—Ç</div>';
  html += '<div class="pm-features">';
  p.features.forEach(f => {
    html += '<div class="pm-feature"><span class="pm-feature-icon">' + f[0] + '</span><span>' + esc(f[1]) + '</span></div>';
  });
  html += '</div></div>';

  // Audience
  html += '<div class="pm-section">';
  html += '<div class="pm-section-title">üë• –î–ª—è –∫–æ–≥–æ</div>';
  html += '<div class="pm-audience">' + esc(p.audience) + '</div>';
  html += '</div>';

  // CTA
  html += '<div class="pm-cta">';
  html += '<button class="pm-cta-btn pm-cta-primary" onclick="closePreview();selectPricing(\'' + esc(type) + '\')">–ó–∞–∫–∞–∑–∞—Ç—å ' + esc(type) + ' –∑–∞ ' + p.price.toLocaleString('ru') + '‚ÇΩ</button>';
  html += '<button class="pm-cta-btn pm-cta-secondary" onclick="closePreview()">–ù–∞–∑–∞–¥</button>';
  html += '</div>';

  html += '</div>'; // pm-body

  modal.innerHTML = html;
  document.getElementById('previewOverlay').classList.add('active');
  document.body.style.overflow = 'hidden';
}

function closePreview() {
  document.getElementById('previewOverlay').classList.remove('active');
  document.body.style.overflow = '';
}

function renderMockup(m, type) {
  if (!m) return '';
  const isDark = !m.sections.some(s => s.dark);

  let html = '<div class="pm-mockup">';

  // Browser bar
  html += '<div class="pm-mockup-bar">';
  html += '<div class="pm-dot pm-dot-r"></div><div class="pm-dot pm-dot-y"></div><div class="pm-dot pm-dot-g"></div>';
  html += '<div class="pm-mockup-url">' + esc(m.url) + '</div>';
  html += '</div>';

  // Body
  html += '<div class="pm-mockup-body" style="background:' + m.bg + ';padding:20px">';

  m.sections.forEach(s => {
    const textColor = s.dark ? '#333' : '#fff';
    const subColor = s.dark ? '#666' : 'rgba(255,255,255,0.8)';

    if (s.type === 'header') {
      html += '<div style="text-align:center;padding:16px 0">';
      html += '<div style="font-size:20px;font-weight:800;color:' + textColor + ';letter-spacing:-0.5px;font-family:Manrope,sans-serif">' + esc(s.text) + '</div>';
      if (s.sub) html += '<div style="font-size:12px;color:' + subColor + ';margin-top:4px">' + esc(s.sub) + '</div>';
      html += '</div>';
    }
    else if (s.type === 'info') {
      html += '<div style="display:flex;flex-direction:column;gap:6px;padding:8px 0">';
      s.items.forEach(item => {
        html += '<div style="font-size:12px;color:' + textColor + ';text-align:center">' + esc(item) + '</div>';
      });
      html += '</div>';
    }
    else if (s.type === 'features') {
      html += '<div style="display:flex;justify-content:center;gap:12px;padding:8px 0;flex-wrap:wrap">';
      s.items.forEach(item => {
        html += '<div style="padding:6px 12px;border-radius:8px;background:rgba(255,255,255,0.15);font-size:11px;color:' + textColor + ';backdrop-filter:blur(4px)">' + esc(item) + '</div>';
      });
      html += '</div>';
    }
    else if (s.type === 'grid') {
      html += '<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;padding:8px 0">';
      s.items.forEach(item => {
        const lines = item.split('\n');
        html += '<div style="padding:12px;border-radius:8px;background:rgba(' + (s.dark ? '0,0,0,0.04' : '255,255,255,0.12') + ');text-align:center">';
        html += '<div style="font-size:13px;font-weight:600;color:' + textColor + '">' + esc(lines[0]) + '</div>';
        if (lines[1]) html += '<div style="font-size:11px;color:' + subColor + ';margin-top:2px">' + esc(lines[1]) + '</div>';
        html += '</div>';
      });
      html += '</div>';
    }
    else if (s.type === 'cta') {
      const btnBg = s.dark ? 'linear-gradient(135deg,#333,#555)' : 'linear-gradient(135deg,rgba(255,255,255,0.2),rgba(255,255,255,0.1))';
      const btnColor = s.dark ? '#fff' : '#fff';
      const btnBorder = s.dark ? 'none' : '1px solid rgba(255,255,255,0.3)';
      html += '<div style="text-align:center;padding:8px 0">';
      html += '<div style="display:inline-block;padding:10px 28px;border-radius:10px;background:' + btnBg + ';color:' + btnColor + ';font-size:13px;font-weight:700;border:' + btnBorder + '">' + esc(s.text) + '</div>';
      html += '</div>';
    }
  });

  html += '<div class="pm-mockup-label">–ü—Ä–∏–º–µ—Ä ¬∑ ' + esc(type) + '</div>';
  html += '</div></div>';

  return html;
}

// Close on Escape
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') closePreview();
});

function populateTypeSelect() {
  const sel = document.getElementById('ofType');
  sel.innerHTML = '<option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø ‚Äî</option>';
  for (const [name, p] of Object.entries(PRICING)) {
    sel.innerHTML += `<option value="${esc(name)}">${p.emoji} ${esc(name)} ‚Äî ${p.price.toLocaleString('ru')}‚ÇΩ</option>`;
  }
  sel.innerHTML += '<option value="–î—Ä—É–≥–æ–µ">üìå –î—Ä—É–≥–æ–µ (–æ–±—Å—É–¥–∏–º)</option>';
}

// ‚ïê‚ïê‚ïê RENDER FAQ ‚ïê‚ïê‚ïê
function renderFAQ() {
  const list = document.getElementById('faqList');
  list.innerHTML = FAQ_DATA.map((f, i) => `
    <div class="faq-item" onclick="this.classList.toggle('open')">
      <div class="faq-q">${esc(f.q)}</div>
      <div class="faq-a">${esc(f.a)}</div>
    </div>
  `).join('');
}

// ‚ïê‚ïê‚ïê RENDER PORTFOLIO ‚ïê‚ïê‚ïê
function renderPortfolio() {
  const grid = document.getElementById('portfolioGrid');
  grid.innerHTML = PORTFOLIO_DATA.map(p => `
    <div class="port-card">
      <div class="port-img">${p.emoji}</div>
      <div class="port-info">
        <div class="port-name">${esc(p.name)}</div>
        <div class="port-desc">${esc(p.desc)}</div>
      </div>
    </div>
  `).join('');
}

// ‚ïê‚ïê‚ïê SCROLL ‚ïê‚ïê‚ïê
function scrollToOrder(e) {
  e.preventDefault();
  document.getElementById('order').scrollIntoView({ behavior: 'smooth' });
}

// ‚ïê‚ïê‚ïê SUBMIT ORDER ‚ïê‚ïê‚ïê
async function submitOrder() {
  const name = document.getElementById('ofName').value.trim();
  if (!name) { toast('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å–∞'); document.getElementById('ofName').focus(); return; }

  const contact = document.getElementById('ofContact').value.trim();
  const phone = document.getElementById('ofPhone').value.trim();
  const city = document.getElementById('ofCity').value.trim();
  const type = selectedType || document.getElementById('ofType').value || '–õ–µ–Ω–¥–∏–Ω–≥';
  const link = document.getElementById('ofLink').value.trim();
  const pricing = PRICING[type] || { price: 0 };

  const btn = document.getElementById('ofSubmit');
  btn.disabled = true;
  btn.textContent = '‚è≥ –°–æ–∑–¥–∞—ë–º –∑–∞–∫–∞–∑...';

  try {
    // Generate unique token for this client
    const token = generateToken();

    // Create direction in Supabase
    const row = {
      name: name,
      project: '–°–∞–π—Ç—ã',
      status: '–í —Ä–∞–±–æ—Ç–µ',
      stage: 'prospect',
      site_type: type,
      price: pricing.price || 0,
      paid: false,
      client_name: contact || name,
      phone: phone,
      city: city,
      link: link,
      source: '–û–Ω–ª–∞–π–Ω-–∑–∞—è–≤–∫–∞',
      next_contact: new Date(Date.now() + 86400000).toISOString().slice(0, 10),
      manager: '',
      touches: 0,
      created_at: new Date().toISOString().slice(0, 10),
      client_token: token,
      questionnaire: JSON.stringify({
        _version: 2,
        _source: 'client_order_form',
        _created: new Date().toISOString(),
        business_info: { name, type: type, city, link },
        contact: { name: contact, phone }
      })
    };

    const { data, error } = await SB.from('directions').insert(row).select();
    if (error) throw error;

    currentDir = data[0];
    clientToken = token;

    // Save token to localStorage for return visits
    localStorage.setItem('rkt_order_token', token);

    // Notify team via n8n (non-blocking)
    notifyTeam(name, type, phone, city).catch(e => console.warn('Notify failed:', e));

    // Open chat
    openChat();

  } catch(e) {
    console.error('Submit error:', e);
    toast('–û—à–∏–±–∫–∞: ' + (e.message || '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑'));
    btn.disabled = false;
    btn.textContent = 'ü§ñ –ù–∞—á–∞—Ç—å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Å AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º';
  }
}

// ‚ïê‚ïê‚ïê LOAD EXISTING CLIENT ‚ïê‚ïê‚ïê
async function loadExistingClient(token) {
  try {
    const { data, error } = await SB.from('directions').select('*').eq('client_token', token).single();
    if (error || !data) {
      hideLoading();
      toast('–°—Å—ã–ª–∫–∞ —É—Å—Ç–∞—Ä–µ–ª–∞. –û—Ñ–æ—Ä–º–∏—Ç–µ –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑.');
      return;
    }

    currentDir = data;
    clientToken = token;

    // Load chat history
    const dirId = data.id;
    const { data: msgs } = await SB.from('anketa_chat').select('*').eq('direction_id', dirId).order('created_at', { ascending: true });
    chatHistory = msgs || [];

    hideLoading();
    openChat(true);

  } catch(e) {
    console.error('Load error:', e);
    hideLoading();
    toast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
  }
}

// ‚ïê‚ïê‚ïê CHAT ‚ïê‚ïê‚ïê
function openChat(skipGreeting) {
  document.getElementById('landingPage').style.display = 'none';
  document.getElementById('chatScreen').classList.add('active');
  hideLoading();

  const msgs = document.getElementById('chatMessages');
  msgs.innerHTML = '';

  // Render existing messages
  chatHistory.forEach(m => {
    if (m.role === 'user' || m.role === 'assistant') {
      appendMsg(m.role, m.content, m.media_urls);
    }
  });

  // Update progress
  if (currentDir) {
    updateProgress(currentDir.anketa_completeness || 0);
  }

  // Auto-greeting if new
  if (!skipGreeting || !chatHistory.length) {
    sendAutoGreeting();
  }

  // Scroll to bottom
  msgs.scrollTop = msgs.scrollHeight;

  // Focus input
  setTimeout(() => document.getElementById('chatInput').focus(), 300);
}

function backToLanding() {
  document.getElementById('chatScreen').classList.remove('active');
  document.getElementById('landingPage').style.display = 'block';
}

function appendMsg(role, content, mediaUrls) {
  const container = document.getElementById('chatMessages');
  const div = document.createElement('div');
  div.className = 'msg ' + role;

  let html = '';
  if (mediaUrls && Array.isArray(mediaUrls) && mediaUrls.length) {
    html += '<div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:6px">';
    mediaUrls.forEach(m => {
      if ((m.type === 'image' || /\.(jpg|jpeg|png|gif|webp)/i.test(m.url || ''))) {
        html += '<img src="' + escA(m.url) + '" onclick="window.open(this.src)" alt="—Ñ–æ—Ç–æ">';
      }
    });
    html += '</div>';
  }
  if (content) {
    html += formatText(content);
  }
  div.innerHTML = html;
  container.appendChild(div);
  container.scrollTop = container.scrollHeight;
  return div;
}

function formatText(text) {
  return esc(text)
    .replace(/\n/g, '<br>')
    .replace(/\*\*(.*?)\*\*/g, '<b>$1</b>')
    .replace(/\*(.*?)\*/g, '<em>$1</em>');
}

// ‚ïê‚ïê‚ïê AUTO GREETING ‚ïê‚ïê‚ïê
async function sendAutoGreeting() {
  const dir = currentDir;
  if (!dir) return;
  const dirId = dir.id;

  const typingDiv = appendMsg('assistant', '');
  typingDiv.innerHTML = '<div class="typing-dots"><span></span><span></span><span></span></div>';
  document.getElementById('chatStatus').textContent = '‚óè –ø–µ—á–∞—Ç–∞–µ—Ç...';

  try {
    const q = parseQ(dir);
    const prompt = buildSystemPrompt(dir, q);

    const res = await fetch(AI_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        message: '–ü–æ–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–π –∫–ª–∏–µ–Ω—Ç–∞ –∏ –Ω–∞—á–Ω–∏ —Å–æ–±–∏—Ä–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é. –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Å—è –∫–∞–∫ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –≤–µ–±-—Å—Ç—É–¥–∏–∏.',
        context: 'anketa',
        source: 'client_order',
        direction: dir.name || '',
        directionId: dirId,
        user: '–ö–ª–∏–µ–Ω—Ç',
        questionnaire: q,
        stage: dir.stage || 'prospect',
        history: [],
        media: [],
        systemPrompt: prompt,
        isClientMode: true
      }),
      signal: AbortSignal.timeout(60000)
    });

    let data = await res.json();
    if (Array.isArray(data)) data = data[0] || {};
    if (data.json) data = data.json;
    let aiText = data.reply || data.response || data.text || data.message || '';
    if (!aiText && data.content) { try { aiText = data.content[0].text; } catch(e) {} }
    if (!aiText) aiText = '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! üëã –Ø AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –≤–µ–±-—Å—Ç—É–¥–∏–∏. –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ –≤–∞—à–µ–º –±–∏–∑–Ω–µ—Å–µ, –∏ –º—ã —Å–æ–∑–¥–∞–¥–∏–º –¥–ª—è –≤–∞—Å –∏–¥–µ–∞–ª—å–Ω—ã–π —Å–∞–π—Ç!';

    const parsed = parseAiResponse(aiText);
    typingDiv.innerHTML = formatText(parsed.visibleText);

    // Save to DB
    await SB.from('anketa_chat').insert({
      direction_id: dirId,
      role: 'assistant',
      content: parsed.visibleText,
      extracted_data: parsed.extracted || {}
    });
    chatHistory.push({ role: 'assistant', content: parsed.visibleText });

    if (parsed.completeness !== null) updateProgress(parsed.completeness);

  } catch(e) {
    console.warn('Greeting error:', e);
    typingDiv.innerHTML = formatText('–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! üëã –Ø AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –≤–µ–±-—Å—Ç—É–¥–∏–∏. –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –≤–∞—à–µ–º –±–∏–∑–Ω–µ—Å–µ ‚Äî –∫–∞–∫–∏–µ —É—Å–ª—É–≥–∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç–µ, –∫—Ç–æ –≤–∞—à–∏ –∫–ª–∏–µ–Ω—Ç—ã? –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –º–Ω–µ —Å–¥–µ–ª–∞—Ç—å –¥–ª—è –≤–∞—Å –ª—É—á—à–∏–π —Å–∞–π—Ç!');
  }

  document.getElementById('chatStatus').textContent = '‚óè –æ–Ω–ª–∞–π–Ω';
}

// ‚ïê‚ïê‚ïê SEND MESSAGE ‚ïê‚ïê‚ïê
async function sendMessage() {
  if (sending) return;
  const input = document.getElementById('chatInput');
  const text = input.value.trim();
  if (!text && !pendingFiles.length) return;

  const dir = currentDir;
  if (!dir) return;
  const dirId = dir.id;

  sending = true;
  document.getElementById('chatSendBtn').disabled = true;
  input.value = '';
  input.style.height = 'auto';

  // Upload files
  let mediaUrls = [];
  if (pendingFiles.length) {
    toast('üì§ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤...');
    for (const file of pendingFiles) {
      try {
        const resized = await resizeImage(file);
        const path = 'client/' + dirId + '/' + Date.now() + '_' + slugify(file.name);
        const { error } = await SB.storage.from('anketa').upload(path, resized, { contentType: resized.type, upsert: false });
        if (!error) {
          const { data: urlData } = SB.storage.from('anketa').getPublicUrl(path);
          if (urlData?.publicUrl) mediaUrls.push({ type: 'image', url: urlData.publicUrl, name: file.name });
        }
      } catch(e) { console.warn('Upload error:', e); }
    }
    pendingFiles = [];
    document.getElementById('mediaPreview').innerHTML = '';
    document.getElementById('mediaPreview').classList.remove('show');
  }

  // Show user message
  let displayText = text;
  if (mediaUrls.length) displayText += (text ? '\n' : '') + 'üìé ' + mediaUrls.length + ' —Ñ–∞–π–ª(–æ–≤)';
  appendMsg('user', displayText, mediaUrls);

  // Save user message
  let fullContent = text;
  if (mediaUrls.length) fullContent += '\n[–ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–æ: ' + mediaUrls.map(m => m.name).join(', ') + ']';
  await SB.from('anketa_chat').insert({ direction_id: dirId, role: 'user', content: fullContent, media_urls: mediaUrls });
  chatHistory.push({ role: 'user', content: fullContent, media_urls: mediaUrls });

  // Typing indicator
  const typingDiv = appendMsg('assistant', '');
  typingDiv.innerHTML = '<div class="typing-dots"><span></span><span></span><span></span></div>';
  document.getElementById('chatStatus').textContent = '‚óè –ø–µ—á–∞—Ç–∞–µ—Ç...';

  try {
    const history = chatHistory.slice(-16).map(m => ({ role: m.role === 'user' ? 'user' : 'assistant', content: (m.content || '').slice(0, 2000) }));
    const q = parseQ(dir);
    const prompt = buildSystemPrompt(dir, q);
    const hasMedia = mediaUrls.length > 0;
    const isLongRequest = /(?:–Ω–∞–ø–∏—à–∏|—Å–æ—Å—Ç–∞–≤—å|–ø–æ–¥–≥–æ—Ç–æ–≤—å|—Å–¥–µ–ª–∞–π|—Å–æ–∑–¥–∞–π|–æ—Ñ–æ—Ä–º–∏|–¥–∞–≤–∞–π)[^.]{0,30}(?:—Ç–µ–∫—Å—Ç|–∫–ø|–ø—Ä–µ–¥–ª–æ–∂–µ–Ω|–ø–∏—Å—å–º|–æ–ø–∏—Å–∞–Ω)/i.test((text || '').toLowerCase());
    const timeout = isLongRequest ? 150000 : hasMedia ? 120000 : 90000;

    // Retry logic
    let aiText = '';
    for (let attempt = 1; attempt <= 2; attempt++) {
      try {
        const controller = new AbortController();
        const tmr = setTimeout(() => controller.abort(), attempt === 1 ? timeout : timeout + 60000);
        const res = await fetch(AI_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            message: fullContent,
            context: 'anketa',
            source: 'client_order',
            direction: dir.name || '',
            directionId: dirId,
            user: '–ö–ª–∏–µ–Ω—Ç',
            questionnaire: q,
            stage: dir.stage || 'prospect',
            history: history,
            media: mediaUrls,
            systemPrompt: prompt,
            isClientMode: true
          }),
          signal: controller.signal
        });
        clearTimeout(tmr);

        let data = await res.json();
        if (Array.isArray(data)) data = data[0] || {};
        if (data.json) data = data.json;
        aiText = data.reply || data.response || data.text || data.message || '';
        if (!aiText && data.content) { try { aiText = data.content[0].text; } catch(e) {} }
        if (aiText) break;
      } catch(retryErr) {
        if (attempt < 2 && retryErr.name === 'AbortError') {
          typingDiv.innerHTML = '<div class="typing-dots"><span></span><span></span><span></span></div><div style="font-size:11px;color:var(--text3);margin-top:4px">–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞...</div>';
          continue;
        }
        throw retryErr;
      }
    }

    if (!aiText) aiText = '–ò–∑–≤–∏–Ω–∏—Ç–µ, –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞–ø—Ä–æ—Å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑ –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –ø–æ-–¥—Ä—É–≥–æ–º—É.';

    const parsed = parseAiResponse(aiText);

    // Typewriter effect
    typingDiv.innerHTML = '';
    const words = parsed.visibleText.split(/([\s]+)/);
    let idx = 0;
    await new Promise(resolve => {
      const iv = setInterval(() => {
        if (idx >= words.length) { clearInterval(iv); resolve(); return; }
        const chunk = words.slice(idx, idx + 4).join('');
        typingDiv.innerHTML += formatText(chunk);
        idx += 4;
        document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
      }, 25);
    });

    // Save assistant message
    await SB.from('anketa_chat').insert({
      direction_id: dirId,
      role: 'assistant',
      content: parsed.visibleText,
      extracted_data: parsed.extracted || {}
    });
    chatHistory.push({ role: 'assistant', content: parsed.visibleText });

    // Update questionnaire
    if (parsed.extracted && Object.keys(parsed.extracted).length) {
      const updatedQ = mergeQ(q, parsed.extracted);
      if (parsed.completeness !== null) updatedQ._completeness = parsed.completeness;
      await SB.from('directions').update({
        questionnaire: JSON.stringify(updatedQ),
        anketa_completeness: parsed.completeness || dir.anketa_completeness || 0
      }).eq('id', dirId);
      dir.questionnaire = JSON.stringify(updatedQ);
    }

    if (parsed.completeness !== null) updateProgress(parsed.completeness);

  } catch(e) {
    console.error('Send error:', e);
    const isAbort = e.name === 'AbortError';
    typingDiv.innerHTML = isAbort
      ? '<span style="color:var(--yellow)">‚è± –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∏—Å—Ç–µ–∫–ª–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑ ‚Äî AI –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –≤–∞—à –∑–∞–ø—Ä–æ—Å.</span>'
      : '<span style="color:var(--red)">–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.</span>';
  }

  sending = false;
  document.getElementById('chatSendBtn').disabled = false;
  document.getElementById('chatStatus').textContent = '‚óè –æ–Ω–ª–∞–π–Ω';
  document.getElementById('chatInput').focus();
}

// ‚ïê‚ïê‚ïê FILE HANDLING ‚ïê‚ïê‚ïê
function attachFiles() {
  document.getElementById('fileInput').click();
}

function filesSelected(input) {
  const files = Array.from(input.files);
  if (!files.length) return;
  pendingFiles.push(...files);
  renderMediaPreview();
  input.value = '';
}

function renderMediaPreview() {
  const container = document.getElementById('mediaPreview');
  if (!pendingFiles.length) { container.classList.remove('show'); container.innerHTML = ''; return; }
  container.classList.add('show');
  container.innerHTML = pendingFiles.map((f, i) => {
    const isImg = f.type.startsWith('image/');
    return `<div class="media-item">
      ${isImg ? '<img class="media-thumb" src="' + URL.createObjectURL(f) + '">' : '<div class="media-thumb" style="display:flex;align-items:center;justify-content:center;background:var(--bg3);font-size:11px;color:var(--text2)">üìÑ</div>'}
      <button class="media-remove" onclick="removeFile(${i})">√ó</button>
    </div>`;
  }).join('');
}

function removeFile(idx) {
  pendingFiles.splice(idx, 1);
  renderMediaPreview();
}

// ‚ïê‚ïê‚ïê AI RESPONSE PARSING ‚ïê‚ïê‚ïê
function parseAiResponse(text) {
  let visibleText = text;
  let extracted = {};
  let completeness = null;

  // Extract JSON block
  const jsonMatch = text.match(/```json\s*([\s\S]*?)```/);
  if (jsonMatch) {
    try {
      extracted = JSON.parse(jsonMatch[1]);
      visibleText = text.replace(/```json[\s\S]*?```/, '').trim();
    } catch(e) {}
  }

  // Extract completeness
  const compMatch = text.match(/(?:completeness|–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å|–∑–∞–ø–æ–ª–Ω–µ–Ω)[:\s]*(\d+)/i);
  if (compMatch) completeness = Math.min(100, parseInt(compMatch[1]));
  if (extracted.completeness) completeness = Math.min(100, parseInt(extracted.completeness));
  if (extracted._completeness) completeness = Math.min(100, parseInt(extracted._completeness));

  // Clean markdown artifacts
  visibleText = visibleText.replace(/---[\s]*$/gm, '').replace(/^\s*#{1,3}\s*/gm, '').trim();

  return { visibleText, extracted, completeness };
}

// ‚ïê‚ïê‚ïê SYSTEM PROMPT ‚ïê‚ïê‚ïê
function buildSystemPrompt(dir, q) {
  const name = dir.name || '–ö–ª–∏–µ–Ω—Ç';
  const type = dir.site_type || q?.business_info?.type || '';
  const city = dir.city || q?.business_info?.city || '';
  const stage = dir.stage || 'prospect';

  let collected = '';
  if (q && q._version === 2) {
    ['business_info','contact','content','design','media','services','custom'].forEach(s => {
      if (q[s] && Object.keys(q[s]).length) collected += '\n' + s + ': ' + JSON.stringify(q[s]);
    });
  }

  let p = '–¢—ã ‚Äî AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –≤–µ–±-—Å—Ç—É–¥–∏–∏. –û–±—â–∞–µ—à—å—Å—è –ù–ê–ü–†–Ø–ú–£–Æ —Å –∫–ª–∏–µ–Ω—Ç–æ–º.\n\n';

  p += '## –ü–†–ê–í–ò–õ–ê:\n';
  p += '- –ó–∞–¥–∞–≤–∞–π –ø–æ –û–î–ù–û–ú–£ –≤–æ–ø—Ä–æ—Å—É –∑–∞ —Ä–∞–∑, –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–π\n';
  p += '- –ë—É–¥—å –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º, –∫—Ä–∞—Ç–∫–∏–º\n';
  p += '- –û—Ç–≤–µ—á–∞–π –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –∫–ª–∏–µ–Ω—Ç–∞, –µ—Å–ª–∏ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç ‚Äî –ù–ï –∏–≥–Ω–æ—Ä–∏—Ä—É–π\n';
  p += '- –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –ø—Ä–æ—Å–∏—Ç –Ω–∞–ø–∏—Å–∞—Ç—å —Ç–µ–∫—Å—Ç/–ö–ü/–æ–ø–∏—Å–∞–Ω–∏–µ ‚Äî –ù–ê–ü–ò–®–ò –µ–≥–æ, –∞ –Ω–µ –∑–∞–¥–∞–≤–∞–π –≤–æ–ø—Ä–æ—Å—ã\n';
  p += '- –§–æ—Ä–º–∞—Ç: –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç, –∏—Å–ø–æ–ª—å–∑—É–π **–∂–∏—Ä–Ω—ã–π** –¥–ª—è –∞–∫—Ü–µ–Ω—Ç–æ–≤\n';
  p += '- –í –∫–æ–Ω—Ü–µ –∫–∞–∂–¥–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –¥–æ–±–∞–≤—å JSON-–±–ª–æ–∫ —Å –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏\n\n';

  p += '## –û –ö–õ–ò–ï–ù–¢–ï:\n';
  p += '- –ë–∏–∑–Ω–µ—Å: ' + name + '\n';
  if (type) p += '- –¢–∏–ø —Å–∞–π—Ç–∞: ' + type + '\n';
  if (city) p += '- –ì–æ—Ä–æ–¥: ' + city + '\n';

  if (collected) {
    p += '\n## –°–û–ë–†–ê–ù–û:\n' + collected + '\n';
    p += '\n–ù–ï —Å–ø—Ä–∞—à–∏–≤–∞–π —Ç–æ, —á—Ç–æ —É–∂–µ –∏–∑–≤–µ—Å—Ç–Ω–æ!\n';
  }

  p += '\n## –ß–¢–û –£–ó–ù–ê–¢–¨ (–ø–æ –æ–¥–Ω–æ–º—É!):\n';
  p += '1. –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –±–∏–∑–Ω–µ—Å–µ (—á–µ–º –∑–∞–Ω–∏–º–∞–µ—Ç–µ—Å—å, –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞, –∞—É–¥–∏—Ç–æ—Ä–∏—è)\n';
  p += '2. –£—Å–ª—É–≥–∏/—Ç–æ–≤–∞—Ä—ã —Å —Ü–µ–Ω–∞–º–∏\n';
  p += '3. –ö–æ–Ω—Ç–∞–∫—Ç—ã (—Ç–µ–ª–µ—Ñ–æ–Ω, —Å–æ—Ü—Å–µ—Ç–∏, –∞–¥—Ä–µ—Å, —á–∞—Å—ã —Ä–∞–±–æ—Ç—ã)\n';
  p += '4. –°—Ç–∏–ª—å (—Ü–≤–µ—Ç–∞, –ø—Ä–∏–º–µ—Ä—ã —Å–∞–π—Ç–æ–≤ –∫–æ—Ç–æ—Ä—ã–µ –Ω—Ä–∞–≤—è—Ç—Å—è)\n';
  p += '5. –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ (–ª–æ–≥–æ—Ç–∏–ø, —Ñ–æ—Ç–æ –ø—Ä–æ–¥—É–∫—Ü–∏–∏/–∏–Ω—Ç–µ—Ä—å–µ—Ä–∞)\n';
  p += '6. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è\n\n';

  p += '## JSON-–§–û–†–ú–ê–¢ (–≤ –∫–æ–Ω—Ü–µ –æ—Ç–≤–µ—Ç–∞):\n';
  p += '```json\n{"business_info":{"type":"...","description":"..."},"services":[...],"contact":{"phone":"...","hours":"..."},"design":{"colors":"...","style":"..."},"completeness":25}\n```\n';
  p += 'completeness ‚Äî –æ—Ü–µ–Ω–∫–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏ –æ—Ç 0 –¥–æ 100.\n';

  return p;
}

// ‚ïê‚ïê‚ïê HELPERS ‚ïê‚ïê‚ïê
function parseQ(dir) {
  try { return JSON.parse(dir.questionnaire || '{}'); } catch(e) { return {}; }
}

function mergeQ(existing, newData) {
  const m = JSON.parse(JSON.stringify(existing));
  m._version = 2;
  m._last_updated = new Date().toISOString();
  for (const [k, v] of Object.entries(newData)) {
    if (k.startsWith('_')) { m[k] = v; continue; }
    if (typeof v === 'object' && v !== null && !Array.isArray(v)) {
      if (!m[k]) m[k] = {};
      for (const [kk, vv] of Object.entries(v)) {
        if (vv !== null && vv !== undefined && vv !== '') m[k][kk] = vv;
      }
    } else {
      m[k] = v;
    }
  }
  return m;
}

function updateProgress(pct) {
  const n = Math.min(100, Math.max(0, parseInt(pct) || 0));
  document.getElementById('cpPct').textContent = n + '%';
  document.getElementById('cpFill').style.width = n + '%';
}

function generateToken() {
  const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
  let t = '';
  for (let i = 0; i < 24; i++) t += chars[Math.floor(Math.random() * chars.length)];
  return t;
}

function slugify(s) {
  return s.replace(/[^a-zA-Z0-9._-]/g, '_').slice(0, 60);
}

function esc(s) {
  if (!s) return '';
  const d = document.createElement('div');
  d.textContent = String(s);
  return d.innerHTML;
}

function escA(s) {
  return esc(s).replace(/"/g, '&quot;');
}

function toast(msg) {
  const el = document.getElementById('toastEl');
  el.textContent = msg;
  el.classList.add('show');
  setTimeout(() => el.classList.remove('show'), 3000);
}

function autoResize(el) {
  el.style.height = 'auto';
  el.style.height = Math.min(el.scrollHeight, 120) + 'px';
}

function resizeImage(file, maxDim = 1568, quality = 0.85) {
  return new Promise(resolve => {
    if (!file.type.startsWith('image/') || file.size < 1024 * 1024) return resolve(file);
    if (file.type === 'image/gif' || file.type === 'image/svg+xml') return resolve(file);
    const img = new Image();
    const url = URL.createObjectURL(file);
    img.onload = () => {
      URL.revokeObjectURL(url);
      let { width, height } = img;
      if (width <= maxDim && height <= maxDim && file.size < 3 * 1024 * 1024) return resolve(file);
      if (width > height) { if (width > maxDim) { height = Math.round(height * maxDim / width); width = maxDim; } }
      else { if (height > maxDim) { width = Math.round(width * maxDim / height); height = maxDim; } }
      const canvas = document.createElement('canvas');
      canvas.width = width; canvas.height = height;
      canvas.getContext('2d').drawImage(img, 0, 0, width, height);
      canvas.toBlob(blob => {
        if (blob && blob.size < file.size) resolve(new File([blob], file.name.replace(/\.[^.]+$/, '.jpg'), { type: 'image/jpeg' }));
        else resolve(file);
      }, 'image/jpeg', quality);
    };
    img.onerror = () => { URL.revokeObjectURL(url); resolve(file); };
    img.src = url;
  });
}

async function notifyTeam(name, type, phone, city) {
  try {
    await fetch(AI_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        message: 'üÜï –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ —Å —Å–∞–π—Ç–∞!\n\n–ö–ª–∏–µ–Ω—Ç: ' + name + '\n–¢–∏–ø: ' + type + '\n–¢–µ–ª–µ—Ñ–æ–Ω: ' + (phone || '–Ω–µ —É–∫–∞–∑–∞–Ω') + '\n–ì–æ—Ä–æ–¥: ' + (city || '–Ω–µ —É–∫–∞–∑–∞–Ω'),
        context: 'notification',
        source: 'client_order'
      }),
      signal: AbortSignal.timeout(10000)
    });
  } catch(e) {}
}

// ‚ïê‚ïê‚ïê MOBILE: SWIPE-TO-CLOSE PREVIEW ‚ïê‚ïê‚ïê
(function() {
  let startY = 0, currentY = 0, isDragging = false;
  const overlay = document.getElementById('previewOverlay');
  const modal = document.getElementById('previewModal');

  modal.addEventListener('touchstart', (e) => {
    // Only enable swipe if at scroll top
    if (modal.scrollTop > 5) return;
    startY = e.touches[0].clientY;
    isDragging = true;
    modal.style.transition = 'none';
  }, { passive: true });

  modal.addEventListener('touchmove', (e) => {
    if (!isDragging) return;
    currentY = e.touches[0].clientY;
    const diff = currentY - startY;
    if (diff > 0) {
      modal.style.transform = 'translateY(' + diff + 'px)';
      overlay.style.background = 'rgba(0,0,0,' + Math.max(0.1, 0.7 - diff / 500) + ')';
    }
  }, { passive: true });

  modal.addEventListener('touchend', () => {
    if (!isDragging) return;
    isDragging = false;
    modal.style.transition = 'transform 0.3s';
    const diff = currentY - startY;
    if (diff > 120) {
      closePreview();
    } else {
      modal.style.transform = '';
      overlay.style.background = '';
    }
    currentY = 0;
    startY = 0;
  });
})();

// ‚ïê‚ïê‚ïê TOUCH FEEDBACK FOR CARDS ‚ïê‚ïê‚ïê
document.addEventListener('DOMContentLoaded', () => {
  // Add active states for touch devices
  const style = document.createElement('style');
  style.textContent = `
    @media (hover: none) {
      .price-card:active { transform: scale(0.97); }
      .pc-info:active { background: rgba(124,111,247,0.2); }
      .pm-cta-btn:active { transform: scale(0.97); }
      .hero-cta:active { transform: scale(0.97); }
      .of-submit:active { transform: scale(0.98); }
      .faq-item:active { background: var(--bg2); }
    }
  `;
  document.head.appendChild(style);
});
</script>
</body>
</html>
