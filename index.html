<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RKT HUB ‚Äî –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Unbounded:wght@300;400;600;700;900&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0a0e17;
  --bg2: #111827;
  --bg3: #1a2234;
  --accent: #00d4aa;
  --accent2: #00b894;
  --red: #ff6b6b;
  --orange: #ffa94d;
  --yellow: #ffd43b;
  --blue: #4dabf7;
  --purple: #b197fc;
  --text: #e8ecf1;
  --text2: #8899aa;
  --border: #243044;
  --glass: rgba(17, 24, 39, 0.85);
  --radius: 12px;
  --shadow: 0 4px 30px rgba(0,0,0,0.4);
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
  font-family: 'JetBrains Mono', monospace;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
}

body::before {
  content: '';
  position: fixed;
  top: -50%; left: -50%;
  width: 200%; height: 200%;
  background: radial-gradient(ellipse at 20% 50%, rgba(0,212,170,0.06) 0%, transparent 50%),
              radial-gradient(ellipse at 80% 20%, rgba(75,171,247,0.04) 0%, transparent 50%),
              radial-gradient(ellipse at 50% 80%, rgba(177,151,252,0.03) 0%, transparent 50%);
  z-index: 0;
  pointer-events: none;
}

.app { position: relative; z-index: 1; display: flex; min-height: 100vh; }

/* ===== SIDEBAR ===== */
.sidebar {
  width: 260px;
  background: var(--bg2);
  border-right: 1px solid var(--border);
  padding: 24px 0;
  display: flex;
  flex-direction: column;
  position: fixed;
  top: 0; left: 0; bottom: 0;
  z-index: 100;
  transition: transform 0.3s;
}

.logo {
  padding: 0 24px 24px;
  border-bottom: 1px solid var(--border);
  margin-bottom: 16px;
}

.logo h1 {
  font-family: 'Unbounded', sans-serif;
  font-size: 20px;
  font-weight: 900;
  background: linear-gradient(135deg, var(--accent), var(--blue));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  letter-spacing: -0.5px;
}

.logo span {
  font-size: 11px;
  color: var(--text2);
  display: block;
  margin-top: 4px;
}

.nav { flex: 1; padding: 0 12px; }

.nav-section {
  font-size: 10px;
  color: var(--text2);
  text-transform: uppercase;
  letter-spacing: 2px;
  padding: 16px 12px 8px;
}

.nav-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 12px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 13px;
  color: var(--text2);
  text-decoration: none;
}

.nav-item:hover { background: var(--bg3); color: var(--text); }
.nav-item.active { background: rgba(0,212,170,0.1); color: var(--accent); }
.nav-item .icon { font-size: 18px; width: 24px; text-align: center; }
.nav-item .badge {
  margin-left: auto;
  background: var(--accent);
  color: var(--bg);
  font-size: 10px;
  font-weight: 700;
  padding: 2px 7px;
  border-radius: 10px;
}

/* ===== MAIN ===== */
.main {
  flex: 1;
  margin-left: 260px;
  padding: 32px;
  max-width: 1200px;
}

.page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 28px;
}

.page-header h2 {
  font-family: 'Unbounded', sans-serif;
  font-size: 24px;
  font-weight: 700;
}

.btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 10px 20px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  font-family: 'JetBrains Mono', monospace;
  font-size: 13px;
  font-weight: 600;
  transition: all 0.2s;
}

.btn-primary {
  background: var(--accent);
  color: var(--bg);
}
.btn-primary:hover { background: var(--accent2); transform: translateY(-1px); }

.btn-secondary {
  background: var(--bg3);
  color: var(--text);
  border: 1px solid var(--border);
}
.btn-secondary:hover { border-color: var(--accent); }

.btn-danger { background: rgba(255,107,107,0.15); color: var(--red); border: 1px solid rgba(255,107,107,0.3); }
.btn-danger:hover { background: rgba(255,107,107,0.25); }

/* ===== METRICS ===== */
.metrics {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
  margin-bottom: 28px;
}

.metric-card {
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px;
  position: relative;
  overflow: hidden;
}

.metric-card::after {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 3px;
}

.metric-card:nth-child(1)::after { background: var(--accent); }
.metric-card:nth-child(2)::after { background: var(--blue); }
.metric-card:nth-child(3)::after { background: var(--orange); }
.metric-card:nth-child(4)::after { background: var(--purple); }
.metric-card:nth-child(5)::after { background: var(--yellow); }

.metric-card .icon { font-size: 28px; margin-bottom: 8px; }
.metric-card .value {
  font-family: 'Unbounded', sans-serif;
  font-size: 28px;
  font-weight: 900;
  line-height: 1;
}
.metric-card .label { font-size: 12px; color: var(--text2); margin-top: 4px; }

/* ===== TABLE ===== */
.card {
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  margin-bottom: 24px;
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 20px;
  border-bottom: 1px solid var(--border);
}

.card-header h3 { font-size: 15px; font-weight: 600; }

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
}

th {
  text-align: left;
  padding: 12px 16px;
  color: var(--text2);
  font-weight: 600;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 1px;
  border-bottom: 1px solid var(--border);
  background: var(--bg3);
}

td {
  padding: 12px 16px;
  border-bottom: 1px solid rgba(36,48,68,0.5);
  vertical-align: middle;
}

tr:hover td { background: rgba(0,212,170,0.03); }

.status {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 3px 10px;
  border-radius: 20px;
  font-size: 11px;
  font-weight: 600;
}

.status-active { background: rgba(0,212,170,0.15); color: var(--accent); }
.status-talks { background: rgba(255,169,77,0.15); color: var(--orange); }
.status-research { background: rgba(75,171,247,0.15); color: var(--blue); }
.status-pause { background: rgba(136,153,170,0.15); color: var(--text2); }
.status-urgent { background: rgba(255,107,107,0.15); color: var(--red); }
.status-work { background: rgba(177,151,252,0.15); color: var(--purple); }

.priority-p1 { color: var(--red); font-weight: 700; }
.priority-p2 { color: var(--orange); font-weight: 600; }
.priority-p3 { color: var(--text2); }

.progress-bar {
  width: 80px;
  height: 6px;
  background: var(--bg);
  border-radius: 3px;
  overflow: hidden;
}
.progress-bar-fill {
  height: 100%;
  border-radius: 3px;
  background: var(--accent);
  transition: width 0.3s;
}

.actions-cell { display: flex; gap: 4px; }
.action-btn {
  width: 28px; height: 28px;
  display: flex; align-items: center; justify-content: center;
  border-radius: 6px;
  border: 1px solid var(--border);
  background: transparent;
  color: var(--text2);
  cursor: pointer;
  font-size: 14px;
  transition: all 0.15s;
}
.action-btn:hover { border-color: var(--accent); color: var(--accent); background: rgba(0,212,170,0.05); }
.action-btn.del:hover { border-color: var(--red); color: var(--red); background: rgba(255,107,107,0.05); }

/* ===== MODAL ===== */
.modal-overlay {
  display: none;
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.7);
  backdrop-filter: blur(4px);
  z-index: 1000;
  justify-content: center;
  align-items: center;
}
.modal-overlay.show { display: flex; }

.modal {
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: 16px;
  width: 500px;
  max-width: 90vw;
  max-height: 85vh;
  overflow-y: auto;
  box-shadow: var(--shadow);
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 24px;
  border-bottom: 1px solid var(--border);
}

.modal-header h3 {
  font-family: 'Unbounded', sans-serif;
  font-size: 16px;
  font-weight: 700;
}

.modal-close {
  width: 32px; height: 32px;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: transparent;
  color: var(--text2);
  cursor: pointer;
  font-size: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
}
.modal-close:hover { color: var(--red); border-color: var(--red); }

.modal-body { padding: 24px; }

.form-group { margin-bottom: 16px; }
.form-group label {
  display: block;
  font-size: 12px;
  color: var(--text2);
  margin-bottom: 6px;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.form-group input,
.form-group select,
.form-group textarea {
  width: 100%;
  padding: 10px 14px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--text);
  font-family: 'JetBrains Mono', monospace;
  font-size: 13px;
  transition: border-color 0.2s;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
  outline: none;
  border-color: var(--accent);
}

.form-group textarea { min-height: 80px; resize: vertical; }

.form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

.modal-footer {
  padding: 16px 24px;
  border-top: 1px solid var(--border);
  display: flex;
  justify-content: flex-end;
  gap: 8px;
}

/* ===== LOADING ===== */
.loading {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 60px;
  flex-direction: column;
  gap: 16px;
}

.spinner {
  width: 36px; height: 36px;
  border: 3px solid var(--border);
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin { to { transform: rotate(360deg); } }

/* ===== CONFIG BANNER ===== */
.config-banner {
  background: linear-gradient(135deg, rgba(255,169,77,0.1), rgba(255,107,107,0.1));
  border: 1px solid rgba(255,169,77,0.3);
  border-radius: var(--radius);
  padding: 20px 24px;
  margin-bottom: 24px;
}

.config-banner h3 { color: var(--orange); font-size: 14px; margin-bottom: 8px; }
.config-banner p { color: var(--text2); font-size: 12px; line-height: 1.6; }
.config-banner input {
  width: 100%;
  padding: 10px 14px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--text);
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
  margin-top: 10px;
}
.config-banner .btn { margin-top: 10px; }

/* ===== EMPTY STATE ===== */
.empty { text-align: center; padding: 40px; color: var(--text2); }
.empty .icon { font-size: 40px; margin-bottom: 12px; }

/* ===== RESPONSIVE ===== */
@media (max-width: 768px) {
  .sidebar { transform: translateX(-100%); }
  .sidebar.open { transform: translateX(0); }
  .main { margin-left: 0; padding: 16px; }
  .metrics { grid-template-columns: repeat(2, 1fr); }
  .form-row { grid-template-columns: 1fr; }
  .mobile-toggle {
    display: flex !important;
    position: fixed;
    top: 12px; left: 12px;
    z-index: 200;
    width: 40px; height: 40px;
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 8px;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: var(--text);
    font-size: 20px;
  }
}

.mobile-toggle { display: none; }

/* ===== PAGE SECTIONS (hidden/shown) ===== */
.page { display: none; }
.page.active { display: block; }

.toast {
  position: fixed;
  bottom: 24px;
  right: 24px;
  background: var(--accent);
  color: var(--bg);
  padding: 12px 20px;
  border-radius: 8px;
  font-size: 13px;
  font-weight: 600;
  transform: translateY(100px);
  opacity: 0;
  transition: all 0.3s;
  z-index: 2000;
}
.toast.show { transform: translateY(0); opacity: 1; }
</style>
</head>
<body>

<button class="mobile-toggle" onclick="document.querySelector('.sidebar').classList.toggle('open')">‚ò∞</button>

<div class="app">
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="logo">
      <h1>RKT HUB</h1>
      <span>–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞–º–∏</span>
    </div>
    <nav class="nav">
      <div class="nav-section">–ì–ª–∞–≤–Ω–æ–µ</div>
      <a class="nav-item active" onclick="showPage('dashboard')" data-page="dashboard">
        <span class="icon">üìä</span> –î–∞—à–±–æ—Ä–¥
      </a>

      <div class="nav-section">–î–∞–Ω–Ω—ã–µ</div>
      <a class="nav-item" onclick="showPage('partners')" data-page="partners">
        <span class="icon">ü§ù</span> –ü–∞—Ä—Ç–Ω—ë—Ä—ã <span class="badge" id="badge-partners">0</span>
      </a>
      <a class="nav-item" onclick="showPage('projects')" data-page="projects">
        <span class="icon">üìÅ</span> –ü—Ä–æ–µ–∫—Ç—ã <span class="badge" id="badge-projects">0</span>
      </a>
      <a class="nav-item" onclick="showPage('tasks')" data-page="tasks">
        <span class="icon">‚úÖ</span> –ó–∞–¥–∞—á–∏ <span class="badge" id="badge-tasks">0</span>
      </a>
      <a class="nav-item" onclick="showPage('directions')" data-page="directions">
        <span class="icon">üìÇ</span> –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
      </a>

      <div class="nav-section">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
      <a class="nav-item" onclick="showPage('staff')" data-page="staff">
        <span class="icon">üë•</span> –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏
      </a>
      <a class="nav-item" onclick="showPage('approvals')" data-page="approvals">
        <span class="icon">üìã</span> –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è <span class="badge" id="badge-approvals" style="background:var(--orange)">0</span>
      </a>
      <a class="nav-item" onclick="showPage('comms')" data-page="comms">
        <span class="icon">üí¨</span> –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
      </a>

      <div class="nav-section">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
      <a class="nav-item" onclick="showPage('settings')" data-page="settings">
        <span class="icon">‚öôÔ∏è</span> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
      </a>
    </nav>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="main">

    <!-- CONFIG BANNER -->
    <div class="config-banner" id="configBanner">
      <h3>‚öôÔ∏è –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets</h3>
      <p>–í—Å—Ç–∞–≤—å URL Google Apps Script –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –¥–∞–Ω–Ω—ã–º. –ë–µ–∑ –Ω–µ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ.</p>
      <input type="text" id="apiUrl" placeholder="https://script.google.com/macros/s/...../exec">
      <button class="btn btn-primary" onclick="connectAPI()">–ü–æ–¥–∫–ª—é—á–∏—Ç—å</button>
    </div>

    <!-- ===== DASHBOARD ===== -->
    <div class="page active" id="page-dashboard">
      <div class="page-header">
        <h2>üìä –î–∞—à–±–æ—Ä–¥</h2>
        <button class="btn btn-secondary" onclick="loadData()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
      </div>

      <div class="metrics" id="metrics">
        <div class="metric-card"><div class="icon">ü§ù</div><div class="value" id="m-partners">0</div><div class="label">–ü–∞—Ä—Ç–Ω—ë—Ä–æ–≤</div></div>
        <div class="metric-card"><div class="icon">üìÅ</div><div class="value" id="m-projects">0</div><div class="label">–ü—Ä–æ–µ–∫—Ç–æ–≤</div></div>
        <div class="metric-card"><div class="icon">‚úÖ</div><div class="value" id="m-tasks">0</div><div class="label">–ó–∞–¥–∞—á</div></div>
        <div class="metric-card"><div class="icon">üë•</div><div class="value" id="m-staff">0</div><div class="label">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</div></div>
        <div class="metric-card"><div class="icon">üìÇ</div><div class="value" id="m-dirs">5</div><div class="label">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π</div></div>
      </div>

      <div class="card">
        <div class="card-header"><h3>üî¥ –°—Ä–æ—á–Ω—ã–µ –∑–∞–¥–∞—á–∏</h3></div>
        <table>
          <thead><tr><th>–ó–∞–¥–∞—á–∞</th><th>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</th><th>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</th><th>–î–µ–¥–ª–∞–π–Ω</th></tr></thead>
          <tbody id="urgent-tasks"></tbody>
        </table>
      </div>

      <div class="card">
        <div class="card-header"><h3>üìÅ –ê–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã</h3></div>
        <table>
          <thead><tr><th>–ü—Ä–æ–µ–∫—Ç</th><th>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</th><th>–°—Ç–∞—Ç—É—Å</th><th>–ü—Ä–æ–≥—Ä–µ—Å—Å</th><th>–î–µ–¥–ª–∞–π–Ω</th></tr></thead>
          <tbody id="active-projects"></tbody>
        </table>
      </div>
    </div>

    <!-- ===== PARTNERS ===== -->
    <div class="page" id="page-partners">
      <div class="page-header">
        <h2>ü§ù –ü–∞—Ä—Ç–Ω—ë—Ä—ã</h2>
        <button class="btn btn-primary" onclick="openModal('partner')">+ –î–æ–±–∞–≤–∏—Ç—å</button>
      </div>
      <div class="card">
        <table>
          <thead><tr><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–°—Ç—Ä–∞–Ω–∞</th><th>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</th><th>–ü—Ä–æ–¥—É–∫—Ç</th><th>–°—Ç–∞—Ç—É—Å</th><th></th></tr></thead>
          <tbody id="partners-table"></tbody>
        </table>
      </div>
    </div>

    <!-- ===== PROJECTS ===== -->
    <div class="page" id="page-projects">
      <div class="page-header">
        <h2>üìÅ –ü—Ä–æ–µ–∫—Ç—ã</h2>
        <button class="btn btn-primary" onclick="openModal('project')">+ –î–æ–±–∞–≤–∏—Ç—å</button>
      </div>
      <div class="card">
        <table>
          <thead><tr><th>–ü—Ä–æ–µ–∫—Ç</th><th>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</th><th>–°—Ç–∞—Ç—É—Å</th><th>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</th><th>–ü—Ä–æ–≥—Ä–µ—Å—Å</th><th>–î–µ–¥–ª–∞–π–Ω</th><th></th></tr></thead>
          <tbody id="projects-table"></tbody>
        </table>
      </div>
    </div>

    <!-- ===== TASKS ===== -->
    <div class="page" id="page-tasks">
      <div class="page-header">
        <h2>‚úÖ –ó–∞–¥–∞—á–∏</h2>
        <button class="btn btn-primary" onclick="openModal('task')">+ –î–æ–±–∞–≤–∏—Ç—å</button>
      </div>
      <div class="card">
        <table>
          <thead><tr><th>–û–ø–∏—Å–∞–Ω–∏–µ</th><th>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</th><th>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</th><th>–°—Ç–∞—Ç—É—Å</th><th>–î–µ–¥–ª–∞–π–Ω</th><th></th></tr></thead>
          <tbody id="tasks-table"></tbody>
        </table>
      </div>
    </div>

    <!-- ===== STAFF ===== -->
    <div class="page" id="page-staff">
      <div class="page-header">
        <h2>üë• –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</h2>
        <button class="btn btn-primary" onclick="openModal('staff')">+ –î–æ–±–∞–≤–∏—Ç—å</button>
      </div>
      <div class="card">
        <table>
          <thead><tr><th>–ò–º—è</th><th>–†–æ–ª—å</th><th>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</th><th>Telegram</th><th>–°—Ç–∞—Ç—É—Å</th><th></th></tr></thead>
          <tbody id="staff-table"></tbody>
        </table>
      </div>
    </div>

    <!-- ===== DIRECTIONS ===== -->
    <div class="page" id="page-directions">
      <div class="page-header"><h2>üìÇ –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2></div>
      <div class="metrics" id="dir-cards"></div>
    </div>

    <!-- ===== APPROVALS ===== -->
    <div class="page" id="page-approvals">
      <div class="page-header"><h2>üìã –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è</h2></div>
      <div class="card">
        <table>
          <thead><tr><th>–¢–∏–ø</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th><th>–û—Ç</th><th>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</th><th>–°—Ç–∞—Ç—É—Å</th><th></th></tr></thead>
          <tbody id="approvals-table"></tbody>
        </table>
      </div>
    </div>

    <!-- ===== COMMS ===== -->
    <div class="page" id="page-comms">
      <div class="page-header">
        <h2>üí¨ –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏</h2>
        <button class="btn btn-primary" onclick="openModal('comm')">+ –ó–∞–ø–∏—Å–∞—Ç—å</button>
      </div>
      <div class="card">
        <table>
          <thead><tr><th>–ü–∞—Ä—Ç–Ω—ë—Ä</th><th>–¢–∏–ø</th><th>–¢–µ–º–∞</th><th>–î–∞—Ç–∞</th><th>–ê–≤—Ç–æ—Ä</th></tr></thead>
          <tbody id="comms-table"></tbody>
        </table>
      </div>
    </div>

    <!-- ===== SETTINGS ===== -->
    <div class="page" id="page-settings">
      <div class="page-header"><h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2></div>
      <div class="card" style="padding:24px">
        <div class="form-group">
          <label>URL Google Apps Script</label>
          <input type="text" id="settingsApiUrl" placeholder="https://script.google.com/macros/s/.../exec">
        </div>
        <div class="form-group">
          <label>Google Sheet ID</label>
          <input type="text" value="1YVGQc7eHOCeCHEKEe1u0G3McdsDPMzXaGh6hWBdMDNI" readonly style="opacity:0.6">
        </div>
        <button class="btn btn-primary" onclick="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </div>

  </main>
</div>

<!-- ===== MODAL ===== -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <div class="modal-header">
      <h3 id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å</h3>
      <button class="modal-close" onclick="closeModal()">‚úï</button>
    </div>
    <div class="modal-body" id="modalBody"></div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
      <button class="btn btn-primary" id="modalSave" onclick="saveModal()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ========== STATE ==========
let API_URL = localStorage.getItem('rkt_api_url') || 'https://daniyal2212.app.n8n.cloud/webhook/rkt-api';
let DATA = {
  partners: [], tasks: [], directions: [], staff: [], projects: [], approvals: [], comms: []
};
let currentModal = '';

// ========== DEMO DATA ==========
const DEMO = {
  partners: [
    {ID:'P001',–ù–∞–∑–≤–∞–Ω–∏–µ:'Syno Medical',–°—Ç—Ä–∞–Ω–∞:'–ö–∏—Ç–∞–π',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–ö–¢',–ü—Ä–æ–¥—É–∫—Ç:'–ö–¢-—Å–∫–∞–Ω–µ—Ä—ã 16/32/64/128 —Å—Ä–µ–∑–æ–≤',–°—Ç–∞—Ç—É—Å:'–ê–∫—Ç–∏–≤–Ω—ã–π'},
    {ID:'P002',–ù–∞–∑–≤–∞–Ω–∏–µ:'Neusoft Medical',–°—Ç—Ä–∞–Ω–∞:'–ö–∏—Ç–∞–π',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–ö–¢',–ü—Ä–æ–¥—É–∫—Ç:'–ö–¢-—Å–∫–∞–Ω–µ—Ä—ã, –ú–†–¢, –£–ó–ò',–°—Ç–∞—Ç—É—Å:'Research'},
    {ID:'P003',–ù–∞–∑–≤–∞–Ω–∏–µ:'United Imaging',–°—Ç—Ä–∞–Ω–∞:'–ö–∏—Ç–∞–π',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–ö–¢',–ü—Ä–æ–¥—É–∫—Ç:'–ö–¢, –ú–†–¢, –ü–≠–¢/–ö–¢',–°—Ç–∞—Ç—É—Å:'Research'},
    {ID:'P004',–ù–∞–∑–≤–∞–Ω–∏–µ:'Browiner',–°—Ç—Ä–∞–Ω–∞:'–ö–∏—Ç–∞–π',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–ö–¢',–ü—Ä–æ–¥—É–∫—Ç:'–ö–¢-—Å–∫–∞–Ω–µ—Ä—ã –±—é–¥–∂–µ—Ç–Ω–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞',–°—Ç–∞—Ç—É—Å:'Research'},
    {ID:'P005',–ù–∞–∑–≤–∞–Ω–∏–µ:'KangDuo',–°—Ç—Ä–∞–Ω–∞:'–ö–∏—Ç–∞–π',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–†–æ–±–æ—Ç—ã',–ü—Ä–æ–¥—É–∫—Ç:'–•–∏—Ä—É—Ä–≥–∏—á–µ—Å–∫–∏–π —Ä–æ–±–æ—Ç',–°—Ç–∞—Ç—É—Å:'–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã'},
    {ID:'P006',–ù–∞–∑–≤–∞–Ω–∏–µ:'MicroPort',–°—Ç—Ä–∞–Ω–∞:'–ö–∏—Ç–∞–π',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–†–æ–±–æ—Ç—ã',–ü—Ä–æ–¥—É–∫—Ç:'Toumai —Ö–∏—Ä—É—Ä–≥–∏—á–µ—Å–∫–∏–π —Ä–æ–±–æ—Ç',–°—Ç–∞—Ç—É—Å:'–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã'},
    {ID:'P007',–ù–∞–∑–≤–∞–Ω–∏–µ:'Intuitive Surgical',–°—Ç—Ä–∞–Ω–∞:'–°–®–ê',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–†–æ–±–æ—Ç—ã',–ü—Ä–æ–¥—É–∫—Ç:'Da Vinci —Ö–∏—Ä—É—Ä–≥–∏—á–µ—Å–∫–∏–π —Ä–æ–±–æ—Ç',–°—Ç–∞—Ç—É—Å:'–ü–∞—É–∑–∞'},
    {ID:'P008',–ù–∞–∑–≤–∞–Ω–∏–µ:'TINAVI',–°—Ç—Ä–∞–Ω–∞:'–ö–∏—Ç–∞–π',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–†–æ–±–æ—Ç—ã',–ü—Ä–æ–¥—É–∫—Ç:'–û—Ä—Ç–æ–ø–µ–¥–∏—á–µ—Å–∫–∏–π —Ä–æ–±–æ—Ç TiRobot',–°—Ç–∞—Ç—É—Å:'Research'},
    {ID:'P009',–ù–∞–∑–≤–∞–Ω–∏–µ:'Wandong Medical',–°—Ç—Ä–∞–Ω–∞:'–ö–∏—Ç–∞–π',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–†–µ–Ω—Ç–≥–µ–Ω',–ü—Ä–æ–¥—É–∫—Ç:'–¶–∏—Ñ—Ä–æ–≤—ã–µ —Ä–µ–Ω—Ç–≥–µ–Ω-–∞–ø–ø–∞—Ä–∞—Ç—ã',–°—Ç–∞—Ç—É—Å:'Research'},
    {ID:'P010',–ù–∞–∑–≤–∞–Ω–∏–µ:'Angell Technology',–°—Ç—Ä–∞–Ω–∞:'–ö–∏—Ç–∞–π',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–†–µ–Ω—Ç–≥–µ–Ω',–ü—Ä–æ–¥—É–∫—Ç:'–ü–æ—Ä—Ç–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ–Ω—Ç–≥–µ–Ω-–∞–ø–ø–∞—Ä–∞—Ç—ã',–°—Ç–∞—Ç—É—Å:'Research'},
    {ID:'P011',–ù–∞–∑–≤–∞–Ω–∏–µ:'Dornier MedTech',–°—Ç—Ä–∞–Ω–∞:'–ì–µ—Ä–º–∞–Ω–∏—è',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–£—Ä–æ–ª–æ–≥–∏—è',–ü—Ä–æ–¥—É–∫—Ç:'–õ–∏—Ç–æ—Ç—Ä–∏–ø—Ç–µ—Ä—ã',–°—Ç–∞—Ç—É—Å:'–ü–∞—É–∑–∞'},
    {ID:'P012',–ù–∞–∑–≤–∞–Ω–∏–µ:'Shenzhen Huikang',–°—Ç—Ä–∞–Ω–∞:'–ö–∏—Ç–∞–π',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–£—Ä–æ–ª–æ–≥–∏—è',–ü—Ä–æ–¥—É–∫—Ç:'–õ–∏—Ç–æ—Ç—Ä–∏–ø—Ç–µ—Ä—ã, —É—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Å—Ç–æ–ª—ã',–°—Ç–∞—Ç—É—Å:'Research'},
    {ID:'P013',–ù–∞–∑–≤–∞–Ω–∏–µ:'Neusoft PACS',–°—Ç—Ä–∞–Ω–∞:'–ö–∏—Ç–∞–π',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'PACS',–ü—Ä–æ–¥—É–∫—Ç:'PACS/RIS —Å–∏—Å—Ç–µ–º—ã',–°—Ç–∞—Ç—É—Å:'Research'},
    {ID:'P014',–ù–∞–∑–≤–∞–Ω–∏–µ:'–†–æ—Å—Ç–µ—Ö',–°—Ç—Ä–∞–Ω–∞:'–†–æ—Å—Å–∏—è',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–ö–¢',–ü—Ä–æ–¥—É–∫—Ç:'–°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Ç–Ω—ë—Ä',–°—Ç–∞—Ç—É—Å:'–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã'},
    {ID:'P015',–ù–∞–∑–≤–∞–Ω–∏–µ:'–†–æ—Å–∞—Ç–æ–º',–°—Ç—Ä–∞–Ω–∞:'–†–æ—Å—Å–∏—è',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–ö–¢',–ü—Ä–æ–¥—É–∫—Ç:'–°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Ç–Ω—ë—Ä',–°—Ç–∞—Ç—É—Å:'Research'},
    {ID:'P016',–ù–∞–∑–≤–∞–Ω–∏–µ:'–û–≠–ó –ê–ª–∞–±—É–≥–∞',–°—Ç—Ä–∞–Ω–∞:'–†–æ—Å—Å–∏—è',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–ö–¢',–ü—Ä–æ–¥—É–∫—Ç:'–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–∞—è –ø–ª–æ—â–∞–¥–∫–∞',–°—Ç–∞—Ç—É—Å:'–ê–∫—Ç–∏–≤–Ω—ã–π'},
  ],
  tasks: [
    {ID:'T001',–û–ø–∏—Å–∞–Ω–∏–µ:'–§–∏–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å OEM-–∫–æ–Ω—Ç—Ä–∞–∫—Ç —Å Syno Medical',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–ö–¢',–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:'P1',–°—Ç–∞—Ç—É—Å:'–í —Ä–∞–±–æ—Ç–µ',–î–µ–¥–ª–∞–π–Ω:'2026-03-01'},
    {ID:'T002',–û–ø–∏—Å–∞–Ω–∏–µ:'–ù–∞–ø–∏—Å–∞—Ç—å –ø–∏—Å—å–º–æ –≤ KangDuo –æ –ø–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–µ',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–†–æ–±–æ—Ç—ã',–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:'P1',–°—Ç–∞—Ç—É—Å:'–í —Ä–∞–±–æ—Ç–µ',–î–µ–¥–ª–∞–π–Ω:'2026-02-15'},
    {ID:'T003',–û–ø–∏—Å–∞–Ω–∏–µ:'–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é –¥–ª—è –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–≤',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–ö–¢',–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:'P1',–°—Ç–∞—Ç—É—Å:'–í —Ä–∞–±–æ—Ç–µ',–î–µ–¥–ª–∞–π–Ω:'2026-02-28'},
    {ID:'T004',–û–ø–∏—Å–∞–Ω–∏–µ:'–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∑–∞—è–≤–∫—É —Ä–µ–∑–∏–¥–µ–Ω—Ç–∞ –û–≠–ó –ê–ª–∞–±—É–≥–∞',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–ö–¢',–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:'P1',–°—Ç–∞—Ç—É—Å:'–í —Ä–∞–±–æ—Ç–µ',–î–µ–¥–ª–∞–π–Ω:'2026-04-01'},
    {ID:'T005',–û–ø–∏—Å–∞–Ω–∏–µ:'–ò–∑—É—á–∏—Ç—å –º–æ–¥–µ–ª—å–Ω—ã–π —Ä—è–¥ Neusoft –ö–¢',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–ö–¢',–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:'P2',–°—Ç–∞—Ç—É—Å:'–í —Ä–∞–±–æ—Ç–µ',–î–µ–¥–ª–∞–π–Ω:'2026-03-15'},
    {ID:'T006',–û–ø–∏—Å–∞–Ω–∏–µ:'–ó–∞–ø—Ä–æ—Å–∏—Ç—å –∫–∞—Ç–∞–ª–æ–≥ —É Wandong Medical',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–†–µ–Ω—Ç–≥–µ–Ω',–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:'P2',–°—Ç–∞—Ç—É—Å:'–í —Ä–∞–±–æ—Ç–µ',–î–µ–¥–ª–∞–π–Ω:'2026-02-28'},
    {ID:'T007',–û–ø–∏—Å–∞–Ω–∏–µ:'–ò–∑—É—á–∏—Ç—å —Ä—ã–Ω–æ–∫ —Ö–∏—Ä—É—Ä–≥–∏—á–µ—Å–∫–∏—Ö —Ä–æ–±–æ—Ç–æ–≤ –≤ –†–§',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–†–æ–±–æ—Ç—ã',–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:'P2',–°—Ç–∞—Ç—É—Å:'–í —Ä–∞–±–æ—Ç–µ',–î–µ–¥–ª–∞–π–Ω:'2026-03-01'},
    {ID:'T008',–û–ø–∏—Å–∞–Ω–∏–µ:'Follow-up MicroPort –ø–æ Toumai',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–†–æ–±–æ—Ç—ã',–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:'P2',–°—Ç–∞—Ç—É—Å:'–í —Ä–∞–±–æ—Ç–µ',–î–µ–¥–ª–∞–π–Ω:'2026-02-20'},
  ],
  directions: [
    {–ù–∞–∑–≤–∞–Ω–∏–µ:'–ö–¢',–°—Ç–∞—Ç—É—Å:'–ê–∫—Ç–∏–≤–Ω—ã–π',–≠—Ç–∞–ø:'–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–º'},
    {–ù–∞–∑–≤–∞–Ω–∏–µ:'–†–µ–Ω—Ç–≥–µ–Ω',–°—Ç–∞—Ç—É—Å:'–ê–∫—Ç–∏–≤–Ω—ã–π',–≠—Ç–∞–ø:'–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ä—ã–Ω–∫–∞'},
    {–ù–∞–∑–≤–∞–Ω–∏–µ:'–†–æ–±–æ—Ç—ã',–°—Ç–∞—Ç—É—Å:'–ê–∫—Ç–∏–≤–Ω—ã–π',–≠—Ç–∞–ø:'–ü–æ–∏—Å–∫ –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤'},
    {–ù–∞–∑–≤–∞–Ω–∏–µ:'–£—Ä–æ–ª–æ–≥–∏—è',–°—Ç–∞—Ç—É—Å:'–ê–∫—Ç–∏–≤–Ω—ã–π',–≠—Ç–∞–ø:'–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ'},
    {–ù–∞–∑–≤–∞–Ω–∏–µ:'PACS',–°—Ç–∞—Ç—É—Å:'–ê–∫—Ç–∏–≤–Ω—ã–π',–≠—Ç–∞–ø:'–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ'},
  ],
  staff: [
    {ID:'EMP001',–ò–º—è:'–î–∞–Ω–∏—è–ª –ê—Ä—Å–ª–∞–Ω–æ–≤',Telegram_ID:'1144907578',–†–æ–ª—å:'CEO',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–í—Å–µ',–°—Ç–∞—Ç—É—Å:'–ê–∫—Ç–∏–≤–Ω—ã–π'},
    {ID:'EMP002',–ò–º—è:'(–ó–∞–º–µ—Å—Ç–∏—Ç–µ–ª—å)',–†–æ–ª—å:'–ó–∞–º',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–í—Å–µ',–°—Ç–∞—Ç—É—Å:'–ê–∫—Ç–∏–≤–Ω—ã–π'},
  ],
  projects: [
    {ID:'PRJ001',–ù–∞–∑–≤–∞–Ω–∏–µ:'–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –ö–¢-16 Syno',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–ö–¢',–°—Ç–∞—Ç—É—Å:'–í —Ä–∞–±–æ—Ç–µ',–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:'P1',–ü—Ä–æ–≥—Ä–µ—Å—Å:'25%',–î–µ–¥–ª–∞–π–Ω:'2027-12-01'},
    {ID:'PRJ002',–ù–∞–∑–≤–∞–Ω–∏–µ:'–ü–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–æ KangDuo',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–†–æ–±–æ—Ç—ã',–°—Ç–∞—Ç—É—Å:'–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã',–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:'P1',–ü—Ä–æ–≥—Ä–µ—Å—Å:'10%',–î–µ–¥–ª–∞–π–Ω:'2027-06-01'},
    {ID:'PRJ003',–ù–∞–∑–≤–∞–Ω–∏–µ:'–†–µ–∑–∏–¥–µ–Ω—Ç –û–≠–ó –ê–ª–∞–±—É–≥–∞',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–ö–¢',–°—Ç–∞—Ç—É—Å:'–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞',–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:'P1',–ü—Ä–æ–≥—Ä–µ—Å—Å:'40%',–î–µ–¥–ª–∞–π–Ω:'2026-04-01'},
    {ID:'PRJ004',–ù–∞–∑–≤–∞–Ω–∏–µ:'–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ä–µ–Ω—Ç–≥–µ–Ω —Ä—ã–Ω–∫–∞',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–†–µ–Ω—Ç–≥–µ–Ω',–°—Ç–∞—Ç—É—Å:'–í —Ä–∞–±–æ—Ç–µ',–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:'P2',–ü—Ä–æ–≥—Ä–µ—Å—Å:'30%',–î–µ–¥–ª–∞–π–Ω:'2026-03-15'},
    {ID:'PRJ005',–ù–∞–∑–≤–∞–Ω–∏–µ:'PACS –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'PACS',–°—Ç–∞—Ç—É—Å:'–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ',–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:'P3',–ü—Ä–æ–≥—Ä–µ—Å—Å:'5%',–î–µ–¥–ª–∞–π–Ω:'2026-06-01'},
  ],
  approvals: [
    {ID:'APR001',–¢–∏–ø:'–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞',–û–ø–∏—Å–∞–Ω–∏–µ:'Syno Medical ‚Üí –ö–æ–Ω—Ç—Ä–∞–∫—Ç',–û—Ç_–∫–æ–≥–æ:'EMP003',–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:'–ö–¢',–°—Ç–∞—Ç—É—Å:'‚è≥ –û–∂–∏–¥–∞–µ—Ç'},
  ],
  comms: []
};

// ========== INIT ==========
window.addEventListener('DOMContentLoaded', () => {
  if (API_URL) {
    document.getElementById('configBanner').style.display = 'none';
    document.getElementById('settingsApiUrl').value = API_URL;
    loadData();
  } else {
    DATA = {...DEMO};
    renderAll();
  }
});

function connectAPI() {
  const url = document.getElementById('apiUrl').value.trim();
  if (!url) return;
  API_URL = url;
  localStorage.setItem('rkt_api_url', url);
  document.getElementById('configBanner').style.display = 'none';
  document.getElementById('settingsApiUrl').value = url;
  loadData();
}

function saveSettings() {
  const url = document.getElementById('settingsApiUrl').value.trim();
  if (url) {
    API_URL = url;
    localStorage.setItem('rkt_api_url', url);
    loadData();
    toast('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
  }
}

// ========== API ==========
async function loadData() {
  if (!API_URL) { DATA = {...DEMO}; renderAll(); return; }
  try {
    const r = await fetch(API_URL + '?action=dashboard');
    const d = await r.json();
    DATA.partners = d.partners || [];
    DATA.tasks = d.tasks || [];
    DATA.directions = d.directions || [];
    DATA.staff = d.staff || [];
    DATA.projects = d.projects || [];
    DATA.approvals = d.approvals || [];
    DATA.comms = d.comms || [];
    renderAll();
    toast('‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
  } catch(e) {
    console.error(e);
    DATA = {...DEMO};
    renderAll();
    toast('‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏, –¥–µ–º–æ-—Ä–µ–∂–∏–º');
  }
}

async function apiPost(action, data) {
  if (!API_URL) {
    // Demo mode: add to local data
    demoAdd(data.sheet, data.row);
    renderAll();
    toast('‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ (–¥–µ–º–æ)');
    return;
  }
  try {
    await fetch(API_URL.replace('rkt-api','rkt-write'), {
      method: 'POST',
      body: JSON.stringify({action, ...data})
    });
    loadData();
    toast('‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
  } catch(e) {
    toast('‚ùå –û—à–∏–±–∫–∞');
  }
}

function demoAdd(sheet, row) {
  const map = {
    '–ü–∞—Ä—Ç–Ω—ë—Ä—ã': 'partners', '–ü—Ä–æ–µ–∫—Ç—ã': 'projects', '–ó–∞–¥–∞—á–∏': 'tasks',
    '–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏': 'staff', '–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏': 'comms', '–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è': 'approvals'
  };
  const key = map[sheet];
  if (key && DATA[key]) DATA[key].push(row);
}

// ========== NAVIGATION ==========
function showPage(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('page-' + page)?.classList.add('active');
  document.querySelector(`[data-page="${page}"]`)?.classList.add('active');
  document.querySelector('.sidebar').classList.remove('open');
}

// ========== RENDER ==========
function renderAll() {
  // Metrics
  document.getElementById('m-partners').textContent = DATA.partners.length;
  document.getElementById('m-projects').textContent = DATA.projects.length;
  document.getElementById('m-tasks').textContent = DATA.tasks.filter(t => t.–°—Ç–∞—Ç—É—Å !== '–ì–æ—Ç–æ–≤–æ').length;
  document.getElementById('m-staff').textContent = DATA.staff.length;
  document.getElementById('m-dirs').textContent = DATA.directions.length;

  // Badges
  document.getElementById('badge-partners').textContent = DATA.partners.length;
  document.getElementById('badge-projects').textContent = DATA.projects.length;
  document.getElementById('badge-tasks').textContent = DATA.tasks.filter(t => t.–°—Ç–∞—Ç—É—Å !== '–ì–æ—Ç–æ–≤–æ').length;
  document.getElementById('badge-approvals').textContent = DATA.approvals.filter(a => a.–°—Ç–∞—Ç—É—Å?.includes('–û–∂–∏–¥–∞–µ—Ç')).length;

  renderUrgentTasks();
  renderActiveProjects();
  renderPartners();
  renderProjects();
  renderTasks();
  renderStaff();
  renderDirections();
  renderApprovals();
}

function statusClass(s) {
  if (!s) return '';
  if (s === '–ê–∫—Ç–∏–≤–Ω—ã–π' || s.includes('–ì–æ—Ç–æ–≤–æ')) return 'status-active';
  if (s === '–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã') return 'status-talks';
  if (s === 'Research' || s.includes('–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ')) return 'status-research';
  if (s === '–ü–∞—É–∑–∞') return 'status-pause';
  if (s.includes('—Ä–∞–±–æ—Ç–µ') || s.includes('–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞')) return 'status-work';
  if (s.includes('–û–∂–∏–¥–∞–µ—Ç')) return 'status-urgent';
  return '';
}

function priorityClass(p) {
  return p === 'P1' ? 'priority-p1' : p === 'P2' ? 'priority-p2' : 'priority-p3';
}

function progressBar(p) {
  const val = parseInt(p) || 0;
  return `<div style="display:flex;align-items:center;gap:8px"><div class="progress-bar"><div class="progress-bar-fill" style="width:${val}%"></div></div><span style="font-size:11px;color:var(--text2)">${val}%</span></div>`;
}

function actionBtns(type, id) {
  return `<div class="actions-cell">
    <button class="action-btn" onclick="editItem('${type}','${id}')" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</button>
    <button class="action-btn del" onclick="deleteItem('${type}','${id}')" title="–£–¥–∞–ª–∏—Ç—å">üóë</button>
  </div>`;
}

function renderUrgentTasks() {
  const el = document.getElementById('urgent-tasks');
  const urgent = DATA.tasks.filter(t => t.–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç === 'P1' && t.–°—Ç–∞—Ç—É—Å !== '–ì–æ—Ç–æ–≤–æ').slice(0, 5);
  el.innerHTML = urgent.length ? urgent.map(t => `<tr>
    <td>${t.–û–ø–∏—Å–∞–Ω–∏–µ || t.–ù–∞–∑–≤–∞–Ω–∏–µ || ''}</td>
    <td>${t.–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ || ''}</td>
    <td><span class="${priorityClass(t.–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç)}">${t.–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç}</span></td>
    <td>${t.–î–µ–¥–ª–∞–π–Ω || '‚Äî'}</td>
  </tr>`).join('') : '<tr><td colspan="4" class="empty">–ù–µ—Ç —Å—Ä–æ—á–Ω—ã—Ö –∑–∞–¥–∞—á üéâ</td></tr>';
}

function renderActiveProjects() {
  const el = document.getElementById('active-projects');
  const active = DATA.projects.filter(p => p.–°—Ç–∞—Ç—É—Å !== '–ó–∞–≤–µ—Ä—à—ë–Ω').slice(0, 5);
  el.innerHTML = active.length ? active.map(p => `<tr>
    <td><strong>${p.–ù–∞–∑–≤–∞–Ω–∏–µ || ''}</strong></td>
    <td>${p.–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ || ''}</td>
    <td><span class="status ${statusClass(p.–°—Ç–∞—Ç—É—Å)}">${p.–°—Ç–∞—Ç—É—Å || ''}</span></td>
    <td>${progressBar(p.–ü—Ä–æ–≥—Ä–µ—Å—Å)}</td>
    <td>${p.–î–µ–¥–ª–∞–π–Ω || '‚Äî'}</td>
  </tr>`).join('') : '<tr><td colspan="5" class="empty">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤</td></tr>';
}

function renderPartners() {
  const el = document.getElementById('partners-table');
  el.innerHTML = DATA.partners.map(p => `<tr>
    <td><strong>${p.–ù–∞–∑–≤–∞–Ω–∏–µ || ''}</strong></td>
    <td>${p.–°—Ç—Ä–∞–Ω–∞ || ''}</td>
    <td>${p.–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ || ''}</td>
    <td style="font-size:12px">${p.–ü—Ä–æ–¥—É–∫—Ç || ''}</td>
    <td><span class="status ${statusClass(p.–°—Ç–∞—Ç—É—Å)}">${p.–°—Ç–∞—Ç—É—Å || ''}</span></td>
    <td>${actionBtns('partner', p.ID)}</td>
  </tr>`).join('');
}

function renderProjects() {
  const el = document.getElementById('projects-table');
  el.innerHTML = DATA.projects.map(p => `<tr>
    <td><strong>${p.–ù–∞–∑–≤–∞–Ω–∏–µ || ''}</strong></td>
    <td>${p.–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ || ''}</td>
    <td><span class="status ${statusClass(p.–°—Ç–∞—Ç—É—Å)}">${p.–°—Ç–∞—Ç—É—Å || ''}</span></td>
    <td><span class="${priorityClass(p.–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç)}">${p.–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç || ''}</span></td>
    <td>${progressBar(p.–ü—Ä–æ–≥—Ä–µ—Å—Å)}</td>
    <td>${p.–î–µ–¥–ª–∞–π–Ω || '‚Äî'}</td>
    <td>${actionBtns('project', p.ID)}</td>
  </tr>`).join('');
}

function renderTasks() {
  const el = document.getElementById('tasks-table');
  const sorted = [...DATA.tasks].sort((a,b) => ({'P1':1,'P2':2,'P3':3}[a.–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç]||9) - ({'P1':1,'P2':2,'P3':3}[b.–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç]||9));
  el.innerHTML = sorted.map(t => `<tr>
    <td>${t.–û–ø–∏—Å–∞–Ω–∏–µ || t.–ù–∞–∑–≤–∞–Ω–∏–µ || ''}</td>
    <td>${t.–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ || ''}</td>
    <td><span class="${priorityClass(t.–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç)}">${t.–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç || ''}</span></td>
    <td><span class="status ${statusClass(t.–°—Ç–∞—Ç—É—Å)}">${t.–°—Ç–∞—Ç—É—Å || ''}</span></td>
    <td>${t.–î–µ–¥–ª–∞–π–Ω || '‚Äî'}</td>
    <td>${actionBtns('task', t.ID)}</td>
  </tr>`).join('');
}

function renderStaff() {
  const el = document.getElementById('staff-table');
  const roleE = {'CEO':'üëë','–ó–∞–º':'‚≠ê','–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å':'üìã'};
  el.innerHTML = DATA.staff.map(s => `<tr>
    <td><strong>${s.–ò–º—è || '(–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ)'}</strong></td>
    <td>${roleE[s.–†–æ–ª—å]||'üë§'} ${s.–†–æ–ª—å || ''}</td>
    <td>${s.–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ || ''}</td>
    <td style="font-size:11px">${s.Telegram_ID ? '‚úÖ ' + s.Telegram_ID : '‚ùå'}</td>
    <td><span class="status ${s.–°—Ç–∞—Ç—É—Å === '–ê–∫—Ç–∏–≤–Ω—ã–π' ? 'status-active' : 'status-pause'}">${s.–°—Ç–∞—Ç—É—Å || ''}</span></td>
    <td>${actionBtns('staff', s.ID)}</td>
  </tr>`).join('');
}

function renderDirections() {
  const el = document.getElementById('dir-cards');
  const emojiMap = {'–ö–¢':'üî¨','–†–µ–Ω—Ç–≥–µ–Ω':'üì°','–†–æ–±–æ—Ç—ã':'ü§ñ','–£—Ä–æ–ª–æ–≥–∏—è':'üíä','PACS':'üíª'};
  el.innerHTML = DATA.directions.map(d => {
    const cnt = DATA.partners.filter(p => (p.–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ||'').includes(d.–ù–∞–∑–≤–∞–Ω–∏–µ)).length;
    const prj = DATA.projects.filter(p => (p.–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ||'').includes(d.–ù–∞–∑–≤–∞–Ω–∏–µ)).length;
    const tsk = DATA.tasks.filter(t => (t.–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ||'').includes(d.–ù–∞–∑–≤–∞–Ω–∏–µ) && t.–°—Ç–∞—Ç—É—Å !== '–ì–æ—Ç–æ–≤–æ').length;
    return `<div class="metric-card" style="cursor:default">
      <div class="icon">${emojiMap[d.–ù–∞–∑–≤–∞–Ω–∏–µ]||'üìå'}</div>
      <div class="value" style="font-size:20px">${d.–ù–∞–∑–≤–∞–Ω–∏–µ}</div>
      <div class="label">${d.–≠—Ç–∞–ø || ''}</div>
      <div style="margin-top:12px;font-size:12px;color:var(--text2)">
        ü§ù ${cnt} –ø–∞—Ä—Ç–Ω. &nbsp; üìÅ ${prj} –ø—Ä–æ–µ–∫—Ç. &nbsp; ‚úÖ ${tsk} –∑–∞–¥–∞—á
      </div>
    </div>`;
  }).join('');
}

function renderApprovals() {
  const el = document.getElementById('approvals-table');
  el.innerHTML = DATA.approvals.length ? DATA.approvals.map(a => `<tr>
    <td>${a.–¢–∏–ø || ''}</td>
    <td>${a.–û–ø–∏—Å–∞–Ω–∏–µ || ''}</td>
    <td>${a.–û—Ç_–∫–æ–≥–æ || ''}</td>
    <td>${a.–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ || ''}</td>
    <td><span class="status ${statusClass(a.–°—Ç–∞—Ç—É—Å)}">${a.–°—Ç–∞—Ç—É—Å || ''}</span></td>
    <td>
      <div class="actions-cell">
        <button class="action-btn" onclick="approveItem('${a.ID}')" title="–û–¥–æ–±—Ä–∏—Ç—å" style="color:var(--accent)">‚úÖ</button>
        <button class="action-btn del" onclick="rejectItem('${a.ID}')" title="–û—Ç–∫–ª–æ–Ω–∏—Ç—å">‚ùå</button>
      </div>
    </td>
  </tr>`).join('') : '<tr><td colspan="6" class="empty">–ù–µ—Ç –æ–∂–∏–¥–∞—é—â–∏—Ö —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–π</td></tr>';
}

// ========== MODALS ==========
const MODAL_FORMS = {
  partner: {title:'–î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä—Ç–Ω—ë—Ä–∞', sheet:'–ü–∞—Ä—Ç–Ω—ë—Ä—ã', fields:[
    {name:'–ù–∞–∑–≤–∞–Ω–∏–µ',type:'text',required:true},
    {name:'–°—Ç—Ä–∞–Ω–∞',type:'text'},
    {name:'–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ',type:'select',options:['–ö–¢','–†–µ–Ω—Ç–≥–µ–Ω','–†–æ–±–æ—Ç—ã','–£—Ä–æ–ª–æ–≥–∏—è','PACS']},
    {name:'–ü—Ä–æ–¥—É–∫—Ç',type:'text'},
    {name:'–°—Ç–∞—Ç—É—Å',type:'select',options:['Research','–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã','–ê–∫—Ç–∏–≤–Ω—ã–π','–ü–∞—É–∑–∞']},
    {name:'–û–ø–∏—Å–∞–Ω–∏–µ',type:'textarea'},
  ]},
  project: {title:'–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç', sheet:'–ü—Ä–æ–µ–∫—Ç—ã', fields:[
    {name:'–ù–∞–∑–≤–∞–Ω–∏–µ',type:'text',required:true},
    {name:'–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ',type:'select',options:['–ö–¢','–†–µ–Ω—Ç–≥–µ–Ω','–†–æ–±–æ—Ç—ã','–£—Ä–æ–ª–æ–≥–∏—è','PACS']},
    {name:'–û–ø–∏—Å–∞–Ω–∏–µ',type:'textarea'},
    {name:'–°—Ç–∞—Ç—É—Å',type:'select',options:['–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ','–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞','–í —Ä–∞–±–æ—Ç–µ','–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã','–ó–∞–≤–µ—Ä—à—ë–Ω']},
    {name:'–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç',type:'select',options:['P1','P2','P3']},
    {name:'–î–µ–¥–ª–∞–π–Ω',type:'date'},
    {name:'–ü—Ä–æ–≥—Ä–µ—Å—Å',type:'text',placeholder:'25%'},
    {name:'–ü–∞—Ä—Ç–Ω—ë—Ä',type:'text'},
  ]},
  task: {title:'–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É', sheet:'–ó–∞–¥–∞—á–∏', fields:[
    {name:'–û–ø–∏—Å–∞–Ω–∏–µ',type:'text',required:true},
    {name:'–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ',type:'select',options:['–ö–¢','–†–µ–Ω—Ç–≥–µ–Ω','–†–æ–±–æ—Ç—ã','–£—Ä–æ–ª–æ–≥–∏—è','PACS','–û–±—â–µ–µ']},
    {name:'–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç',type:'select',options:['P1','P2','P3']},
    {name:'–°—Ç–∞—Ç—É—Å',type:'select',options:['‚è≥ –í –æ—á–µ—Ä–µ–¥–∏','–í —Ä–∞–±–æ—Ç–µ','–ì–æ—Ç–æ–≤–æ']},
    {name:'–î–µ–¥–ª–∞–π–Ω',type:'date'},
  ]},
  staff: {title:'–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞', sheet:'–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏', fields:[
    {name:'–ò–º—è',type:'text',required:true},
    {name:'Telegram_ID',type:'text',placeholder:'ID –∏–∑ Telegram'},
    {name:'Username',type:'text',placeholder:'@username'},
    {name:'–†–æ–ª—å',type:'select',options:['CEO','–ó–∞–º','–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å']},
    {name:'–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ',type:'select',options:['–í—Å–µ','–ö–¢','–†–µ–Ω—Ç–≥–µ–Ω','–†–æ–±–æ—Ç—ã','–£—Ä–æ–ª–æ–≥–∏—è','PACS']},
    {name:'Email',type:'text'},
    {name:'–¢–µ–ª–µ—Ñ–æ–Ω',type:'text'},
  ]},
  comm: {title:'–ó–∞–ø–∏—Å–∞—Ç—å –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é', sheet:'–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏', fields:[
    {name:'–ü–∞—Ä—Ç–Ω—ë—Ä',type:'text',required:true},
    {name:'–¢–∏–ø',type:'select',options:['–ó–≤–æ–Ω–æ–∫','Email','–í—Å—Ç—Ä–µ—á–∞','–ü–∏—Å—å–º–æ','–ß–∞—Ç']},
    {name:'–¢–µ–º–∞',type:'textarea'},
  ]}
};

function openModal(type) {
  currentModal = type;
  const cfg = MODAL_FORMS[type];
  document.getElementById('modalTitle').textContent = cfg.title;

  let html = '';
  for (const f of cfg.fields) {
    html += `<div class="form-group">
      <label>${f.name}${f.required ? ' *' : ''}</label>`;
    if (f.type === 'select') {
      html += `<select id="field-${f.name}">${f.options.map(o => `<option>${o}</option>`).join('')}</select>`;
    } else if (f.type === 'textarea') {
      html += `<textarea id="field-${f.name}" placeholder="${f.placeholder||''}"></textarea>`;
    } else {
      html += `<input type="${f.type}" id="field-${f.name}" placeholder="${f.placeholder||''}">`;
    }
    html += '</div>';
  }

  document.getElementById('modalBody').innerHTML = html;
  document.getElementById('modalOverlay').classList.add('show');
}

function closeModal() {
  document.getElementById('modalOverlay').classList.remove('show');
  currentModal = '';
}

function saveModal() {
  const cfg = MODAL_FORMS[currentModal];
  const row = { ID: currentModal[0].toUpperCase() + String(Date.now()).slice(-5) };

  for (const f of cfg.fields) {
    const el = document.getElementById('field-' + f.name);
    row[f.name] = el?.value || '';
  }

  // Add timestamps
  const now = new Date().toISOString().split('T')[0];
  if (cfg.sheet === '–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏') row['–°—Ç–∞—Ç—É—Å'] = '–ê–∫—Ç–∏–≤–Ω—ã–π';
  if (cfg.sheet === '–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏') row['–î–∞—Ç–∞_–¥–æ–±–∞–≤–ª–µ–Ω–∏—è'] = now;
  if (cfg.sheet === '–ü—Ä–æ–µ–∫—Ç—ã') { row['–°–æ–∑–¥–∞–Ω–æ'] = now; row['–û–±–Ω–æ–≤–ª–µ–Ω–æ'] = now; }

  apiPost('add', { sheet: cfg.sheet, row });
  closeModal();
}

function editItem(type, id) {
  toast('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
}

function deleteItem(type, id) {
  if (!confirm('–£–¥–∞–ª–∏—Ç—å?')) return;
  const map = {'partner':'partners','project':'projects','task':'tasks','staff':'staff'};
  const key = map[type];
  if (key) DATA[key] = DATA[key].filter(i => i.ID !== id);
  renderAll();
  toast('üóë –£–¥–∞–ª–µ–Ω–æ');
}

function approveItem(id) {
  const a = DATA.approvals.find(i => i.ID === id);
  if (a) a.–°—Ç–∞—Ç—É—Å = '‚úÖ –û–¥–æ–±—Ä–µ–Ω–æ';
  renderAll();
  toast('‚úÖ –û–¥–æ–±—Ä–µ–Ω–æ');
}

function rejectItem(id) {
  const a = DATA.approvals.find(i => i.ID === id);
  if (a) a.–°—Ç–∞—Ç—É—Å = '‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ';
  renderAll();
  toast('‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ');
}

// ========== TOAST ==========
function toast(msg) {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.classList.add('show');
  setTimeout(() => el.classList.remove('show'), 2500);
}
</script>
</body>
</html>
